var config={api_endpoint:"http://localhost:9000/"},Models={},temp_api="http://api.test.planlab.wolkenmachine.nl/",model={get:function(e,t,n){m.request({method:"GET",url:temp_api+e}).catch(function(e){window.alert(e)}).then(n)},post:function(e,t,n){m.request({method:"POST",url:temp_api+e,data:t}).catch(function(e){window.alert(e)}).then(n)},delete:function(e,t,n){m.request({method:"DELETE",url:temp_api+e,data:t}).catch(function(e){window.alert(e)}).then(n)}},stopwoorden=["‘t","a","aan","aangaande","aangezien","achter","achterna","aen","af","afd","afgelopen","agter","al","aldaar","aldus","alhoewel","alias","all’","alle","allebei","alleen","alleenlyk","allen","alles","als","alsnog","altijd","altoos","altyd","ander","andere","anderen","anders","anderszins","anm","b","behalve","behoudens","beide","beiden","ben","beneden","bent","bepaald","beter","betere","betreffende","bij","bijna","bijvoorbeeld","binnen","binnenin","bizonder","bizondere","bl","blz","boven","bovenal","bovendien","bovengenoemd","bovenstaand","bovenvermeld","buiten","by","daar","daarheen","daarin","daarna","daarnet","daarom","daarop","daarvanlangs","daer","dan","dat","de","deeze","den","der","ders","derzelver","des","deszelfs","deszelvs","deze","dezelfde","dezelve","dezelven","dezen","dezer","dezulke","die","dien","dikwijls","dikwyls","dit","dl","doch","doen","doet","dog","door","doorgaand","doorgaans","dr","dra","ds","dus","echter","ed","een","een’","eene","eenen","eener","eenig","eenige","eens","eer","eerdat","eerder","eerlang","eerst","eerste","eersten","effe","egter","eigen","eigene","elk","elkanderen","elkanderens","elke","en","enig","enige","enigerlei","enigszins","enkel","enkele","enz","er","erdoor","et","etc","even","eveneens","evenwel","ff","gauw","ge","gebragt","gedurende","geen","geene","geenen","gegeven","gehad","geheel","geheele","gekund","geleden","gelijk","gelyk","gemoeten","gemogen","geven","geweest","gewoon","gewoonweg","geworden","gezegt","gij","gt","gy","haar","had","hadden","hadt","haer","haere","haeren","haerer","hans","hare","heb","hebben","hebt","heeft","hele","hem","hen","het","hier","hierbeneden","hierboven","hierin","hij","hoe","hoewel","hun","hunne","hunner","hy","ibid","ieder","iemand","iet","iets","ii","ik","ikke","ikzelf","in","indien","inmiddels","inz","inzake","is","ja","je","jezelf","jij","jijzelf","jou","jouw","jouwe","juist","jullie","kan","klaar","kon","konden","krachtens","kunnen","kunt","laetste","lang","later","liet","liever","like","m","maar","maeken","maer","mag","martin","me","mede","meer","meesten","men","menigwerf","met","mezelf","mij","mijn","mijnent","mijner","mijzelf","min","minder","misschien","mocht","mochten","moest","moesten","moet","moeten","mogelijk","mogelyk","mogen","my","myn","myne","mynen","myner","myzelf","na","naar","nabij","nadat","naer","net","niet","niets","nimmer","nit","no","noch","nog","nogal","nooit","nr","nu","o","of","ofschoon","om","omdat","omhoog","omlaag","omstreeks","omtrent","omver","onder","ondertussen","ongeveer","ons","onszelf","onze","onzen","onzer","ooit","ook","oorspr","op","opdat ","opnieuw","opzij","opzy","over","overeind","overigens","p","pas","pp","precies","pres","prof","publ","reeds","rond","rondom","rug","s","sedert","sinds","sindsdien","sl","slechts","sommige","spoedig","st","steeds","sy","t","tamelijk","tamelyk","te","tegen","tegens","ten","tenzij","ter","terwijl","terwyl","thans","tijdens","toch","toe","toen","toenmaals","toenmalig","tot","totdat","tusschen","tussen","tydens","u","uit","uitg","uitgezonderd","uw","uwe","uwen","uwer","vaak","vaakwat","vakgr","van","vanaf","vandaan","vanuit","vanwege","veel","veeleer","veelen","verder","verre","vert","vervolgens","vgl","vol","volgens","voor","vooraf","vooral","vooralsnog","voorbij","voorby","voordat","voordezen","voordien","voorheen","voorop","voort","voortgez","voorts","voortz","vooruit","vrij","vroeg","vry","waar","waarom","wanneer","want","waren","was","wat","we","weer","weg","wege","wegens","weinig","weinige","wel","weldra","welk","welke","welken","welker","werd","werden","werdt","wezen","wie","wiens","wier","wierd","wierden","wij","wijzelf","wil","wilde","worden","wordt","wy","wyze","wyzelf","zal","ze","zeer","zei","zeker","zekere","zelf","zelfde","zelfs","zelve","zelven","zelvs","zich","zichzelf","zichzelve","zichzelven","zie","zig","zij","zijn","zijnde","zijne","zijner","zo","zo’n","zoals","zodra","zommige","zommigen","zonder","zoo","zou","zoude","zouden","zoveel","zowat","zulk","zulke","zulks","zullen","zult","zy","zyn","zynde","zyne","zynen","zyner","zyns","per","via","eind","iedere","zodat","waarbij","enof"];function GetKeywords(){var r={};ptrn("",function(e){return e}).map(function(e){var t=e.type(),n=e;"program"!==t&&"task"!==t&&"effort"!==t&&"mission"!==t&&"kpi"!==t&&"means"!==t&&"description"!==t&&"endproduct"!==t||("mission"===n.type()&&(n=n("program")),"kpi"!==n.type()&&"means"!==n.type()||(n=n("task")),"description"!==n.type()&&"endproduct"!==n.type()||(n=n("effort")),"string"==typeof e.value()&&e.value().replace(/[0123456789,.\"'<>/()+\-*%:;!~_]/g,"").replace(/\r?\n|\r/g,"").toLowerCase().split(" ").map(function(e){1<e.length&&(r[e]?r[e].find(function(e){return e.id()===n.id()})||r[e].push(n):r[e]=[n])}))});var e=[{letter:"a",words:[]},{letter:"b",words:[]},{letter:"c",words:[]},{letter:"d",words:[]},{letter:"e",words:[]},{letter:"f",words:[]},{letter:"g",words:[]},{letter:"h",words:[]},{letter:"i",words:[]},{letter:"j",words:[]},{letter:"k",words:[]},{letter:"l",words:[]},{letter:"m",words:[]},{letter:"n",words:[]},{letter:"o",words:[]},{letter:"p",words:[]},{letter:"q",words:[]},{letter:"r",words:[]},{letter:"s",words:[]},{letter:"t",words:[]},{letter:"u",words:[]},{letter:"v",words:[]},{letter:"w",words:[]},{letter:"x",words:[]},{letter:"y",words:[]},{letter:"z",words:[]}];for(var t in r)if(1<r[t].length&&-1===stopwoorden.indexOf(t)){var n=e.find(function(e){return e.letter===t.charAt(0)});n&&(n.words.push({word:t,refs:r[t]}),n.words=n.words.sort(function(e,t){return e.word<t.word?-1:e.word>t.word?1:0}))}return e}var ptrnold=function(){function f(n){var e=function(e,t){return b(e,t,h(n.oid))};return e.update=function(e){n.newvalue=e},e.drop=function(){n.drop=!0,n.newvalue=void 0},e.transact=function(){if(!0===n.drop)l("POST","drop/"+n.oid,{},function(e){v[e.tid].value.unshift({tid:e.tid,drop:!0})});else if(void 0!==n.newvalue)return console.log("transact"),e=n.oid,t=n.newvalue,l("POST","update/"+e,{value:t},function(e){v[e.id].value.unshift({tid:e.tid,value:e.value}),m.redraw()}),!(n.newvalue=void 0);var e,t;return!1},e.value=function(){return void 0!==n.newvalue?n.newvalue:n.value[0].value},e.type=function(){return n.type},e.id=function(){return n.oid},e}var v=[],a=[],r=0,n={},i={};function o(t,n,e){var r=a.filter(function(e){return!e.value[0].drop&&(e.value[0].aid===t&&e.value[0].bid===n||e.value[0].aid===n&&e.value[0].bid===t)});if(0===r.length){var o={value:[{tid:e,aid:t,bid:n}]};a.push(o),i[t]||(i[t]=[]),i[t].push(o),i[n]||(i[n]=[]),i[n].push(o)}else r[0].tid=e}function g(t,e){return e||(e=v),e.filter(function(e){return!e.drop&&-1<e.value[0].value.toLowerCase().indexOf(t.toLowerCase())})}function h(t){var e=[];return i[t]&&(e=i[t].filter(function(e){return!e.value[0].drop}).map(function(e){return e.value[0].aid===t?v[e.value[0].bid]:v[e.value[0].aid]})),e}function b(e,t,n){var r;n||(n=v);var o,a,i,u=e.split(/ (.+)/),s=u[0];if("#"===s.charAt(0)){var l=parseInt(s.substring(1));r=[];var c=n.find(function(e){return e&&e.oid===l});c&&r.push(c)}else if("*"===s.charAt(0)){r=g(s.substring(1),n)}else{var m=s.split(":"),d="?";1<m.length&&(d=m[1]),m=m[0],o=m,a=d,(i=n)||(i=v),r=i.filter(function(e){return e&&!e.drop&&("?"===o||o===e.type)&&("?"===a||a===e.value[0].value)})}if(1===u.length)return t?r.map(function(e){return t(f(e))}):0<r.length?f(r[0]):f({oid:-1,type:"",value:[{tid:-1,value:""}]});var p=r.map(function(e){return h(e.oid)}).reduce(function(e,t){return e.concat(t)},[]);return p=p.filter(function(e,t){return p.indexOf(e)==t}),b(u[1],t,p)}function u(t){l("GET","dump/"+r,{},function(e){e.nodes.map(function(t){t.tid>r&&(r=t.tid),1===t.del?(v.splice(t.id,1),a=a.filter(function(e){return!(e.value[0].aid===t.id||e.value[0].aid===t.id)})):(v[t.id]={oid:t.id,type:t.type,value:[{tid:t.tid,value:t.value}]},n[t.type]||(n[t.type]=[]),n[t.type].find(function(e){return e===t.id})||n[t.type].push(t.id))}),e.relations.map(function(e){var t,n;0<e.del?(t=e.aid,n=e.bid,a=a.filter(function(e){return!(e.value[0].aid===t&&e.value[0].bid===n||e.value[0].aid===n&&e.value[0].bid===t)}),i[t]=i[t].filter(function(e){return e.value[0].bid!==n}),i[n]=i[n].filter(function(e){return e.value[0].aid!==t}),e.del>r&&(r=e.del)):(o(e.aid,e.bid,e.tid),e.tid>r&&(r=e.tid))}),m.redraw(),console.log(r),t()})}function s(e,t,n){l("POST","relate",{aid:e.id(),bid:t.id()},function(e){o(e.aid,e.bid,e.tid),n&&n(),m.redraw()})}function l(e,t,n,r){var o=config.api_endpoint,a=new XMLHttpRequest;vm.connecting(!0),a.onreadystatechange=function(){4==this.readyState&&200==this.status&&(vm.connecting(!1),r(JSON.parse(this.responseText)))},a.open(e,o+t,!0),a.setRequestHeader("Content-type","application/json"),a.setRequestHeader("Authorization","Basic "+btoa(":"+vm.user().pass)),a.send(JSON.stringify(n))}return b.transact=function(){v.map(function(e){f(e).transact()}),a.filter(function(e){return-1===e.value[0].tid}).map(function(e){var t,n,r,o;!0===e.value[0].drop?(t=f(v[e.value[0].aid]),n=f(v[e.value[0].bid]),r=t.id(),o=n.id(),l("POST","unrelate",{aid:r,bid:o},function(e){})):s(f(v[e.value[0].aid]),f(v[e.value[0].bid]))})},b.find=g,b.compare=function(e,t){return e&&t&&e.id()===t.id()},b.log=function(){console.log(n),console.log(i)},b.create=function(e,t,n){l("POST","create",{type:e,value:t},function(e){v[e.id]||(v[e.id]={oid:e.id,type:e.type,value:[{tid:e.tid,value:e.value}]}),m.redraw(),n(f(v[e.id]))})},b.findorcreate=function(e,t,n){l("POST","findorcreate",{type:e,value:t},function(e){v[e.id]||(v[e.id]={oid:e.id,type:e.type,value:[{tid:e.tid,value:e.value}]}),m.redraw(),n(f(v[e.id]))})},b.relate=s,b.createrelate=function(e,t,n,r){l("POST","createrelate",{type:e,value:t,bid:n.id()},function(e){var t=e.node;v[t.id]||(v[t.id]={oid:t.id,type:t.type,value:[{tid:t.tid,value:t.value}]});var n=e.relation;o(n.aid,n.bid,n.tid),r(f(v[t.id])),m.redraw()})},b.speculativeRelate=function(e,t){o(e.id(),t.id(),-1)},b.speculativeUnrelate=function(e,t){var n=e.id(),r=t.id(),o=a.filter(function(e){return!e.drop&&(e.value[0].aid===n&&e.value[0].bid===r||e.value[0].aid===r&&e.value[0].bid===n)});console.log("unrelate"),console.log(o),0<o.length&&o[0].value.unshift({tid:-1,drop:!0,aid:n,bid:r}),i[n]=i[n].filter(function(e){return e!==r}),i[r]=i[r].filter(function(e){return e!==n})},b.loadall=function(t){l("GET","dump",{},function(e){e.nodes.map(function(e){v[e.id]={oid:e.id,type:e.type,value:[{tid:e.tid,value:e.value}]},e.tid>r&&(r=e.tid),n[e.type]||(n[e.type]=[]),n[e.type].push(e.id)}),e.relations.map(function(e){o(e.aid,e.bid,e.tid),e.tid>r&&(r=e.tid)}),u(function e(){window.setTimeout(function(){u(e)},2e3)}),t()})},b.adduser=function(e,t){l("POST","user/add",{id:e},function(e){t&&t(e)})},b.updateuser=function(e,t,n,r){l("POST","user/set",{id:e,name:t,role:n},function(e){r&&r(e)})},b.loginuser=function(e,t){l("POST","user/hash",{name:e},function(e){t(e.succes)})},b.loginpass=function(e,t,n){l("POST","user/check",{name:e,pass:t},function(e){n(e.succes,e.node,e.role)})},b.getusers=function(t){l("GET","users",{},function(e){userlist=e,t(e)})},b}();function asyncmap(t,n,r){var o=-1;!function e(){o++,t.length>o?n(t[o],e):r&&r()}()}function pushAllTheDataSync(){model.get("overview",{},function(e){var r=0,o=0,a=0;asyncmap(e,function(e,t){ptrn.create("domain",e.name,function(n){asyncmap(e.Programs,function(e,t){r++,a=o=0,ptrn.createrelate("program",e.name,n,function(n){ptrn.createrelate("mission",e.mission,n,function(){ptrn.createrelate("order",r,n,function(){asyncmap(e.Tasks,function(e,t){o++,a=0,ptrn.createrelate("task",e.name,n,function(n){ptrn.createrelate("means",e.means,n,function(){ptrn.createrelate("order",o,n,function(){ptrn.createrelate("kpi",e.kpi,n,function(){ptrn.createrelate("mode",e.mode,n,function(){asyncmap(e.Efforts,function(e,t){a++,ptrn.createrelate("effort",e.name,n,function(n){ptrn.createrelate("description",e.description,n,function(){ptrn.createrelate("endproduct",e.endproduct,n,function(){ptrn.createrelate("type",e.type,n,function(){ptrn.createrelate("order",a,n,function(){ptrn.createrelate("mode",e.mode,n,function(){ptrn.createrelate("startdate","_/_/_",n,function(){ptrn.createrelate("enddate","_/_/_",n,function(){asyncmap(e.People,function(e,t){ptrn.findorcreate("person",e.name,function(e){ptrn.relate(e,n,function(){t()})})},t)})})})})})})})})},t)})})})})})},t)})})})},t)})})})}var ptrn=function(){var r,t,a,i,u,s,o,l,c,n,d,p,f,e,v,g=(i=[],u=[],s=[],l=[],c=o=t=0,n={},d={},(a={}).setage=function(e){t<e&&(t=e)},a.getage=function(){return t},a.transact=function(e){var t={tid:i.length,time:new Date};return a.setage(t.tid),t.node=e(t.tid),t.value=t.node.value[0],i.push(t),t},a.speculativetransact=function(e){var t={tid:i.length+u.length+100001,time:new Date};return t.node=e(t.tid),t.value=t.node.value[0],u.push(t),t},a.reifyspeculativetransactions=function(r){for(var e in u.map(function(t,n){t.node.value=t.node.value.map(function(e){return e.tid===t.tid&&(e.tid=r.newtransactions[n].tid),e}),t.tid=r.newtransactions[n].tid,t.time=r.newtransactions[n].time,a.setage(t.tid),i[t.tid]=t}),u=[],r.speculativeids){var t=parseInt(e),n=r.speculativeids[e];if(s[n]=s[t],s[n].aid=n,delete s[t],d[t]){var o=JSON.parse(JSON.stringify(d[t]));delete d[t],d[n]=o,d[n].map(function(e){d[e]=d[e].map(function(e){return e===t?n:e})})}}l=l.map(function(e){return 1e5<e.aid&&(e.aid=r.speculativeids[e.aid]),1e5<e.bid&&(e.bid=r.speculativeids[e.bid]),e})},a.clearspeculativetransactions=function(){u=[]},a.writeatom=function(e,t,n,r){return s[e]?(s[e].value.push({tid:t,value:r}),s[e].value.sort(function(e,t){return Math.abs(t.tid)-Math.abs(e.tid)})):(s[e]={aid:e,type:n,value:[{tid:t,value:r}]},a.maptypeatom(n,s[e])),s[e]},a.unupdateatom=function(e,t){s[e].value=s[e].value.filter(function(e){return e.tid!==t}),s[e].value.sort(function(e,t){return Math.abs(t.tid)-Math.abs(e.tid)})},a.overwriteatom=function(e,t){return s[e]&&(s[e].value[0].value=t),s[e]},a.createatom=function(e,t,n){var r=o++;return 1e5<e&&(r+=100001),a.writeatom(r,e,t,n)},a.uncreateatom=function(e,t,n){var r=o--;delete s[r]},a.dropatom=function(e,t){return s[e].value.push({tid:t,drop:!0}),s[e].value.sort(function(e,t){return Math.abs(t.tid)-Math.abs(e.tid)}),a.unmaptypeatom(s[e].type,s[e]),s[e]},a.writerelation=function(e,t,n,r){var o=l.find(function(e){return e.aid===t&&e.bid===n||e.aid===n&&e.bid===t});return rid=o?o.rid:c++,l[rid]?(l[rid].value.push({tid:e,value:r}),l[rid].value.sort(function(e,t){return Math.abs(t.tid)-Math.abs(e.tid)})):l[rid]={rid:rid,aid:t,bid:n,value:[{tid:e,value:r}]},r?a.maprelation(t,n):a.unmaprelation(t,n),l[rid]},a.maptypeatom=function(e,t){n[e]||(n[e]=[]),n[e].push(t)},a.unmaptypeatom=function(e,t){n[e]&&(n[e]=n[e].filter(function(e){return e.aid!==t.aid}))},a.maprelation=function(t,n){d[t]||(d[t]=[]),d[t].find(function(e){return e===n})||d[t].push(n),d[n]||(d[n]=[]),d[n].find(function(e){return e===t})||d[n].push(t)},a.unmaprelation=function(t,n){d[t]||(d[t]=[]),d[t]=d[t].filter(function(e){return e!==n}),d[n]||(d[n]=[]),d[n]=d[n].filter(function(e){return e!==t})},a.getspeculativetransactions=function(){return u},a.gettransactions=function(){return i},a.getatoms=function(){return s},a.getrelations=function(){return d},a.getatom=function(e){return s[e]&&!s[e].value[0].drop?s[e]:void 0},a.log=function(){console.log(u),console.log(s),console.log(l)},a),h=p={createatom:function(t,n){if(void 0!==t&&void 0!==n)return g.transact(function(e){return g.createatom(e,t,n)})},updateatom:function(t,n){if(void 0!==t&&void 0!==n)return g.transact(function(e){return g.writeatom(t,e,"",n)})},relate:function(t,n,r){if(void 0!==t&&void 0!==n&&void 0!==r)return g.transact(function(e){return g.writerelation(e,t,n,r)})},dropatom:function(t){if(void 0!==t)return g.transact(function(e){return g.dropatom(t,e)})},sync:function(e){var n=g.gettransactions();e=e.filter(function(e,t){return void 0===n.find(function(e){return e.tid===t})}),p.consume(e)},consume:function(e){var n={},t=e.map(function(e){var t;return"create"===e.transaction?(t=p.createatom(e.type,e.value),n[e.aid]=t.node.aid,t):"update"===e.transaction?(1e5<e.aid&&(e.aid=n[e.aid]),p.updateatom(e.aid,e.value)):"drop"===e.transaction?(1e5<e.aid&&(e.aid=n[e.aid]),p.dropatom(e.aid)):"relate"===e.transaction?(1e5<e.aid&&(e.aid=n[e.aid]),1e5<e.bid&&(e.bid=n[e.bid]),p.relate(e.aid,e.bid,e.value)):void 0});return{speculativeids:n,newtransactions:t}},publish:function(){return g.gettransactions().map(function(e){return void 0!==e.node.rid?{transaction:"relate",value:e.value.value,aid:e.node.aid,bid:e.node.bid}:e.node.value[e.node.value.length-1].tid===e.value.tid?{transaction:"create",value:e.value.value,type:e.node.type,aid:e.node.aid}:e.value.drop?{transaction:"drop",aid:e.node.aid}:{transaction:"update",aid:e.node.aid,value:e.value.value}})}},b={createatom:function(t,n){return g.speculativetransact(function(e){return g.createatom(e,t,n)})},updateatom:function(t,n){if(1e5<g.getatom(t).value[0].tid)return g.overwriteatom(t,n);g.speculativetransact(function(e){return g.writeatom(t,e,"",n)})},relate:function(t,n,r){return g.speculativetransact(function(e){return g.writerelation(e,t,n,r)})},dropatom:function(t){return g.speculativetransact(function(e){return g.dropatom(t,e)})},reify:function(e){return g.reifyspeculativetransactions(e)},publish:function(e){z.publish(g.getspeculativetransactions().map(function(e){return void 0!==e.node.rid?{transaction:"relate",value:e.value.value,aid:e.node.aid,bid:e.node.bid}:e.node.value[e.node.value.length-1].tid===e.value.tid?{transaction:"create",value:e.value.value,type:e.node.type,aid:e.node.aid}:e.value.drop?{transaction:"drop",aid:e.node.aid}:{transaction:"update",aid:e.node.aid,value:e.value.value}}),e)},clear:function(e){console.log(g.getspeculativetransactions()),g.getspeculativetransactions().reverse().map(function(e){void 0!==e.node.rid?g.writerelation(e.tid,e.node.aid,e.node.bid,!e.value.value):e.node.value[e.node.value.length-1].tid===e.value.tid?g.uncreateatom(e.tid):(e.value.drop,g.unupdateatom(e.node.aid,e.tid))}),g.clearspeculativetransactions()},hasspeculations:function(){return 0<g.getspeculativetransactions().length}},y={produce:function(r){var e=function(e,t){var n=w.getatomrelations(r);return k(e,t,n)};return e.value=function(){return r.value[0].value},e.type=function(){return r.type},e.id=function(){return r.aid},e.update=function(e){b.updateatom(r.aid,e)},e.drop=function(){b.dropatom(r.aid)},e}},w=function(){var t={};function r(e){return e||g.getatoms().filter(function(e){return!e.value[0].drop})}return t.getatoms=function(){return r()},t.getatombyid=function(t,e){return r(e).filter(function(e){return e.aid===t})},t.getatomsbytype=function(t,e){return r(e).filter(function(e){return e.type===t})},t.getatomsbytypevalue=function(t,n,e){return r(e).filter(function(e){return e.type===t&&(e.value[0].value===n||e.value[0].value===parseInt(n))})},t.getatomrelations=function(e){return g.getrelations()[e.aid]?g.getrelations()[e.aid].map(function(e){return g.getatoms()[e]}).filter(function(e){return e&&!e.value[0].drop}):[]},t.getsubsetrelations=function(e){var n=e.map(function(e){return t.getatomrelations(e)}).reduce(function(e,t){return e.concat(t)},[]);return n.filter(function(e,t){return e&&n.indexOf(e)==t})},t.search=function(t){return r().filter(function(e){return-1<String(e.value[0].value).toLowerCase().indexOf(t.toLowerCase())})},t}(),k=((f=function(e,t,n){var r=e.split(/ (.+)/),o=r[0],a=[];if(0===o.length)a=w.getatoms();else if("#"===o.charAt(0)){var i=parseInt(o.substring(1));a=w.getatombyid(i,n)}else if("*"===o.charAt(0)){var u=e.substring(1);a=w.search(u)}else{var s=o.split(":"),l=s[0];if(1===s.length)a=w.getatomsbytype(l,n);else{var c=s[1];a=w.getatomsbytypevalue(l,c,n)}}if(1===r.length||"*"===o.charAt(0))return t?a.map(function(e){return t(y.produce(e))}):0<a.length?y.produce(a[0]):y.produce({aid:-1,type:"",value:[{tid:-1,value:""}]});var m=w.getsubsetrelations(a);return k(r[1],t,m)}).consume=h.consume,f.dump=h.publish,f.transact=b.publish,f.getage=g.getage,f.log=g.log,f.create=function(e,t,n){var r=y.produce(b.createatom(e,t).node);return n&&n(r),r},f.relate=function(e,t,n){b.relate(e.id(),t.id(),!0),n&&n()},f.unrelate=function(e,t,n){b.relate(e.id(),t.id(),!1),n&&n()},f.createrelate=function(e,t,n,r){var o=f.create(e,t);return f.relate(o,n),r&&r(o),o},f.speculativeRelate=f.relate,f.speculativeUnrelate=f.unrelate,f.unSpeculate=b.clear,f.hasSpeculations=b.hasspeculations,f.compare=function(e,t){return e&&t&&e.id()===t.id()},f),z=(v={onpublish:[]},(e={}).publish=function(t,n){v.onpublish.map(function(e){e(t,n)})},e.onpublish=function(e){v.onpublish.push(e)},e),D=function(e){void 0!==r&&e.setRequestHeader("x-access-token",r)};return z.onpublish(function(e,t){m.request({method:"POST",url:config.api_endpoint+"/transact",data:e,config:D}).then(function(e){b.reify(e),t&&t()})}),k.onload=function(t){m.request({method:"GET",url:config.api_endpoint+"/dump",config:D}).then(function(e){h.consume(e),k.sync(),t()})},k.sync=function(){m.request({method:"GET",url:config.api_endpoint+"/",config:D}).then(function(e){e.transactions>g.getage()?m.request({method:"GET",url:config.api_endpoint+"/dump",config:D}).then(function(e){h.sync(e),m.redraw(),window.setTimeout(k.sync,5e3)}):window.setTimeout(k.sync,2e3)})},k.adduser=function(e,t){m.request({method:"POST",url:config.api_endpoint+"user/add",config:D,data:{id:e,token:r}}).then(function(e){t&&t(e)})},k.dropuser=function(e,t){m.request({method:"POST",url:config.api_endpoint+"user/drop",config:D,data:{id:e,token:r}}).then(function(e){t&&t(e)})},k.updateuser=function(e,t,n,r){m.request({method:"POST",url:config.api_endpoint+"user/set",data:{id:e,name:t,role:n,config:D}}).then(function(e){r&&r(e)})},k.loginuser=function(e,t){m.request({method:"POST",url:config.api_endpoint+"user/hash",config:D,data:{name:e}}).then(function(e){t(e.succes)})},k.loginpass=function(e,t,n){m.request({method:"POST",url:config.api_endpoint+"user/login",config:D,data:{name:e,pass:t}}).then(function(e){r=e.token,n(e.succes,e.node,e.role,e.token)})},k.logintoken=function(e,t){r=e,m.request({method:"POST",url:config.api_endpoint+"user/check",data:{token:e}}).then(function(e){t(e.success)})},k.getusers=function(t){m.request({method:"GET",url:config.api_endpoint+"users",config:D}).then(function(e){userlist=e,t(e)})},k}(),viewModels={},vm=function(){var t,n,r,o,a,i,u,s=1,l=0,c={user:"",pass:"",node:-1,role:0};try{if("undefined"!=typeof Storage){var e=localStorage.getItem("planlabuser");if(e){var d=JSON.parse(e);d.token&&ptrn.logintoken(d.token,function(e){console.log(e),e&&(s=0,ptrn.onload(function(){vm.person(ptrn("person"))}),m.redraw())})}}}catch(e){console.log(e)}var p,f=!1,v=[];return{connecting:function(e){return void 0!==e&&(f=e,m.redraw()),f},page:function(e){return void 0!==e&&(l=e),l},login:function(e){return void 0!==e&&(s=e),s},logout:function(){try{"undefined"!=typeof Storage?(localStorage.removeItem("planlabuser"),c={user:"",pass:"",node:-1,role:0},s=1):console.log("no localstorage")}catch(e){console.log(e)}},user:function(e){if(void 0!==e){c=e;try{"undefined"!=typeof Storage?localStorage.setItem("planlabuser",JSON.stringify(e)):console.log("no localstorage")}catch(e){console.log(e)}}return c},program:function(e){return void 0!==e&&(n=e,o=r=void 0),n},task:function(e){return void 0!==e&&(r=ptrn.compare(r,e)?void 0:e,o=void 0),r},taskClose:function(e){r=void 0},effort:function(e){return void 0!==e&&(o=ptrn.compare(o,e)?void 0:e),o},effortClose:function(e){o=void 0},person:function(e){return void 0!==e&&(a=e),a},hover:function(e){return void 0!==e&&(u=e),u},unhover:function(){u=void 0},focus:function(e){return void 0!==e&&(t=e),t},create:function(e){return void 0!==e&&(i=e),i},createClose:function(e){i=void 0},closeall:function(){n=r=o=void 0},edit:function(e){return void 0!==e&&(0===s?p=e:s=1),p},editClose:function(){p=void 0},userlist:function(){return v},updateUserList:function(t){console.log("update users"),ptrn.getusers(function(e){console.log("update users - done"),v=e.map(function(e){return e.user=ptrn("#"+e.node),e}),m.redraw(),t&&t()})}}}(),createnew={task:function(){if(vm.program()){var t=vm.program()("task",function(e){return e}).length+1;ptrn.createrelate("task","",vm.program(),function(e){ptrn.createrelate("means","",e,function(){ptrn.createrelate("order",t,e,function(){ptrn.createrelate("mode","0",e,function(){vm.taskClose(),vm.create(e)})})})})}},effort:function(){if(vm.task()){var t=vm.task()("effort",function(e){return e}).length+1;ptrn.createrelate("effort","",vm.task(),function(e){ptrn.createrelate("description","",e,function(){ptrn.createrelate("endproduct","",e,function(){ptrn.createrelate("type","",e,function(){ptrn.createrelate("order",t,e,function(){ptrn.createrelate("mode","-1",e,function(){ptrn.createrelate("startdate","_/_/_",e,function(){ptrn.createrelate("enddate","_/_/_",e,function(){vm.effortClose(),vm.create(e)})})})})})})})})}},user:function(){console.log("adduser"),ptrn.create("person","",function(e){console.log(e.id()),ptrn.createrelate("role","leader",e),ptrn.createrelate("role","aclient",e),ptrn.createrelate("role","bclient",e),ptrn.createrelate("contract","36",e),ptrn.createrelate("plannable","36",e),ptrn.transact(function(){console.log(e.id()),ptrn.adduser(e.id(),function(){vm.updateUserList(function(){vm.edit(e),console.log("update userlist")})})})})}};viewModels.typeNames=["Project","Routine"];var API_VERSION="0.2.0",MagicLogin=function(){var r=!1;return{view:function(e){if(!r){r=!0;var t=location.hash.split("?"),o=t[1],n=t[2];ptrn.loginpass(o,n,function(e,t,n,r){e&&(vm.login(0),vm.user({user:o,node:t,role:n,token:r}),location.href="/",ptrn.onload(function(){vm.person(ptrn("person"))})),location.href="/"})}return m(".magic-login","Inloggen...")}}};function loadgui(){m.route(document.body,"/",{"/":Page,"/magic":MagicLogin,"/help":HelpPage})}Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],a=0;a<r;a++)if(t=n[a],e.call(o,t,a,n))return t});var ArrayFromRange=function(e,t){for(var n=[],r=e;r<=t;r++)n.push(r);return n};Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var a=t[o];if(e.call(r,a,o,t))return o;o++}return-1}}),Array.prototype.emptyState=function(e){var t=Object(this);return 0===t.length?e:t},String.prototype.emptyState=function(e){var t=String(this);return 0===t.length?e:t};var emptyState=function(e,t){return e||t},FuzzyDate={};FuzzyDate.years=function(){for(var e=[{label:"Geen",value:!1,p:!1},{splitter:!0},{label:"Doorlopend",value:"~",p:!1},{splitter:!0}],t=(new Date).getFullYear(),n=0;n<30;n++)e.push({label:t,value:""+t,p:!0}),t++;return e}(),FuzzyDate.months=[{value:!1},{splitter:!0},{label:"1e kwartaal",value:"1k",p:!1},{label:"2e kwartaal",value:"2k",p:!1},{label:"3e kwartaal",value:"3k",p:!1},{label:"4e kwartaal",value:"4k",p:!1},{splitter:!0},{label:"januari",value:"1",p:!0},{label:"februari",value:"2",p:!0},{label:"maart",value:"3",p:!0},{label:"april",value:"4",p:!0},{label:"mei",value:"5",p:!0},{label:"juni",value:"6",p:!0},{label:"juli",value:"7",p:!0},{label:"augustus",value:"8",p:!0},{label:"september",value:"9",p:!0},{label:"october",value:"10",p:!0},{label:"november",value:"11",p:!0},{label:"december",value:"12",p:!0}],FuzzyDate.days=function(){for(var e=[{value:!1},{splitter:!0},{label:"Begin",value:"1k",p:!1},{label:"Midden",value:"2k",p:!1},{label:"Eind",value:"3k",p:!1},{splitter:!0}],t=1;t<32;t++)e.push({label:""+t,value:""+t,p:!0});return e}(),FuzzyDate.toRange=function(e){var t=FuzzyDate.toArray(e),n=new Date(-864e13),r=new Date(864e13);if(!t)return[n,r];if(t[0].p&&t[1].p&&t[2].p)n=new Date(e);else if(t[0].p&&t[1].p){var o=t[0].value,a=t[1].value;t[2].value?"1k"===t[2].value?(n=new Date(o+"/"+a+"/1"),r=new Date(o+"/"+a+"/10")):"2k"===t[2].value?(n=new Date(o+"/"+a+"/10"),r=new Date(o+"/"+a+"/20")):"3k"===t[2].value&&(n=new Date(o+"/"+a+"/20"),r=new Date(o+"/"+a+"/30")):(n=new Date(o+"/"+a+"/1"),r=new Date(o+"/"+a+"/30"))}else if(t[0].p){o=t[0].value;t[1].value?"1k"===t[1].value?(n=new Date(o+"/1/1"),r=new Date(o+"/3/30")):"2k"===t[1].value?(n=new Date(o+"/4/1"),r=new Date(o+"/6/30")):"3k"===t[1].value?(n=new Date(o+"/7/1"),r=new Date(o+"/9/30")):"4k"===t[1].value&&(n=new Date(o+"/10/1"),r=new Date(o+"/12/30")):(n=new Date(o+"/1/1"),r=new Date(o+"/12/30"))}else"~"===t[0].value&&(n=new Date(-864e13),r=new Date(864e13));return[n,r]},FuzzyDate.toWeekRange=function(e,t){var n=FuzzyDate.toRange(e),r=FuzzyDate.toRange(t),o=n[0],a=n[1]?n[1]:n[0],i=r[0],u=r[1]?r[1]:r[0];return[Math.round((i-a)/6048e5),Math.round((u-o)/6048e5)]},FuzzyDate.toArray=function(e){var t=[],n=e.split("/");return t[0]=FuzzyDate.years.find(function(e){return!e.splitter&&e.value===n[0]}),t[1]=FuzzyDate.months.find(function(e){return!e.splitter&&e.value===n[1]}),t[2]=FuzzyDate.days.find(function(e){return!e.splitter&&e.value===n[2]}),"_"===n[0]?t[0]=FuzzyDate.years[0]:"~"===n[0]?t[0]=FuzzyDate.years[2]:t[0]={value:n[0],label:n[0],p:!0},t[1]=t[1]||{value:!1},t[2]=t[2]||{value:!1},t},FuzzyDate.toString=function(e){return(e[0].value||"_")+"/"+(e[1].value||"_")+"/"+(e[2].value||"_")},FuzzyDate.StringfromDate=function(e){return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()},FuzzyDate.toReadableString=function(e){var t=FuzzyDate.toArray(e),n="";return t[2].value&&(n=t[2].label+" "),t[1].value&&(n=n+t[1].label+" "),n=t[0].value?n+t[0].label+" ":"Onbekend"},FuzzyDate.inRange=function(e,t,n){var r=FuzzyDate.toRange(e),o=FuzzyDate.toRange(t),a=r[0],i=o[1]?o[1]:o[0];return a<=n&&n<=i},FuzzyDate.currentWeek=function(e){(e=new Date(e.getTime())).setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},FuzzyDate.currentYear=function(e){return(e=new Date(e.getTime())).setHours(0,0,0,0),e.getFullYear()},FuzzyDate.nextWeek=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()+7)},FuzzyDate.prevWeek=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()-7)},FuzzyDate.nextMonth=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth()+1,t.getDate())},FuzzyDate.prevMonth=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth()-1,t.getDate())},FuzzyDate.prevKwarter=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()-84)},FuzzyDate.nextKwarter=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()+84)},FuzzyDate.nextYear=function(e){var t=new Date(e);return new Date(t.getFullYear()+1,t.getMonth(),t.getDate())},FuzzyDate.getMonday=function(e){var t=new Date(e),n=t.getDay(),r=t.getDate()-n+(0===n?-6:1),o=new Date(t.setDate(r));return new Date(o.getFullYear(),o.getMonth(),o.getDate())},FuzzyDate.getFirstDayOfMonth=function(e){var t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),1)},FuzzyDate.getDateOfWeek=function(e,t){var n=new Date(t,0,1+7*(e-1)),r=n;return n.getDay()<=4?r.setDate(n.getDate()-n.getDay()+1):r.setDate(n.getDate()+8-n.getDay()),r};var HoursSpent={};function perfomancetest(e){var t=performance.now();return e(),performance.now()-t}HoursSpent.Parse=function(e){var t=e.split("-");return{start:t[0],end:t[1],hours:t[2],period:7===t.length&&{length:[t[3],t[4]],every:[t[5],t[6]]}}},HoursSpent.toString=function(e){return e.start+"-"+e.end+"-"+e.hours+(e.period?"-"+e.period.length[0]+"-"+e.period.length[1]+"-"+e.period.every[0]+"-"+e.period.every[1]:"")},Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t};var AdminUsers=function(){return vm.updateUserList(),{view:function(e){return console.log("rendering"),m(".admin",[m(".admin-header",[m(".admin-title.subtitle",[m("span","Gebruikers")])]),m(".admin-labels",[m(".admin-label","Naam"),m(".admin-label","Email"),m(".admin-label","Rol")]),m(".admin-users.state-editable",[vm.userlist().sort(function(e,t){var n=e.user.value().toLowerCase(),r=t.user.value().toLowerCase();return n<r?-1:r<n?1:0}).map(function(e){return m(AdminUser,{user:e})}),m(".admin-user.admin-adduser",m(".admin-user-value",{onclick:function(e){createnew.user()}},"+ nieuwe gebruiker toevoegen"))])])}}},AdminUser=function(){return{view:function(e){var t=e.attrs.user;return m(".admin-user",[m(".admin-user-value",t.user.value()),m(".admin-user-value",t.name),m(".admin-user-value",0===t.role?"Beheerder":""),m(".admin-user-button",{onclick:function(){vm.edit(t.user)}},m(Icon,{name:"edit-white"}))])}}},Contract=function(){return{view:function(e){return m(".admin",[m(".admin-header",[m(".admin-title.subtitle",[m("span","Naam")]),m("span.icon-button.icons-header",{onclick:function(e){vm.edit(ptrn("#"+vm.user().node))}},[m("span.icon-button-hint","Gegevens bewerken"),m(Icon,{name:"edit"})]),m("span",ptrn("#"+vm.user().node).value()),m(".admin-title.subtitle",[m("span","Contract")]),m("span",parseInt(ptrn("#"+vm.user().node+" contract").value())),m("span"," uur per week, waarvan "),m("span",parseInt(ptrn("#"+vm.user().node+" plannable").value())),m("span"," uur inplanbaar.")])])}}},Feedback=function(){var n,t="-1",r=!1,o=!1;function a(e){-1===(n=e)("feedback:"+t).id()&&ptrn.createrelate("feedback",t,n,function(e){ptrn.createrelate("positives","",e,function(){ptrn.createrelate("negatives","",e,function(){ptrn.createrelate("effects","",e,function(e){ptrn.createrelate("explanation","",e,function(){})}),ptrn.createrelate("products","",e,function(e){ptrn.createrelate("explanation","",e,function(){})}),ptrn.createrelate("planning","",e,function(e){ptrn.createrelate("explanation","",e,function(){})}),ptrn.createrelate("stakeholders","",e,function(e){ptrn.createrelate("explanation","",e,function(){})}),ptrn.createrelate("conditions","",e,function(e){ptrn.createrelate("explanation","",e,function(){})})})})})}return{view:function(e){return t=e.attrs.session,void 0===n&&a(ptrn("#"+vm.user().node+" role:leader effort type:0 effort")),m(".admin",[m(".admin-header",[m(".admin-title.subtitle",[m("span","Voortgangs Rapportage")])]),m(".admin-feedback",[m(".admin-feedback-list.layout-thincolumn",[ptrn("#"+vm.user().node+" role:leader effort type:0 effort",function(e){return m(".admin-feedback-list-effort.state-selectable",{onclick:function(){o=!(r=!0),a(e),ptrn.transact()}},[m(Numbering,{node:e,whole:!0,selected:!o&&ptrn.compare(n,e),disabled:-1===e("feedback:"+t).id()}),m(".admin-feedback-list-effort-name",e.value())])}),m(".admin-feedback-list-done",{class:o?"state-selected":"",onclick:function(){o=!0}},"Opslaan en verzenden")]),m(".admin-feedback-questions.layout-thickcolumn",{onupdate:function(e){r&&(r=!1,e.dom.scrollTop=0)}},o?[m(".feedback-section",[m(".editor-section-title.title","Je hebt de voortgangsrapportage ingevuld."),m(".save-button",{onclick:function(){e.attrs.onsave()}},"Opslaan")])]:[m(".feedback-section",[m(".editor-section-title.title","Algemene Toelichting"),m(".editor-row",[m(".editor-column",[m(".editor-subtitle.subtitle",[m("span","Waarover maak jij je zorgen? Wat gaat er minder goed?")]),m(TextArea,{value:n("feedback:"+t+" positives").value(),onchange:function(e){n("feedback:"+t+" positives").update(e)}})]),m(".editor-column",[m(".editor-subtitle.subtitle",[m("span","Waar ben je trots op? Wat gaat goed?")]),m(TextArea,{value:n("feedback:"+t+" negatives").value(),onchange:function(e){n("feedback:"+t+" negatives").update(e)}})])])]),m(".feedback-section",[m(".editor-section-title.title","Voortgang"),m(FeedbackQuestion,{currentFeedback:n("feedback:"+t),label:"Effect",name:"effects"}),m(FeedbackQuestion,{currentFeedback:n("feedback:"+t),label:"Producten",name:"products"}),m(FeedbackQuestion,{currentFeedback:n("feedback:"+t),label:"Planning",name:"planning"}),m(FeedbackQuestion,{currentFeedback:n("feedback:"+t),label:"Stakeholders",name:"stakeholders"}),m(FeedbackQuestion,{currentFeedback:n("feedback:"+t),label:"Randvoorwaarden",name:"conditions"})]),m(".feedback-section",[m(".save-button",{onclick:function(){var e,t;ptrn.transact(),e=ptrn("#"+vm.user().node+" role:leader effort type:0 effort",function(e){return e}),(t=e.map(function(e){return e.id()}).indexOf(n.id()))+1<e.length?(r=!0,a(e[t+1])):o=r=!0}},"Verder")])])])])}}},FeedbackQuestion=function(){return{view:function(t){var n=t.attrs.currentFeedback;return m(".editor-row",[m(".editor-column",[m(".editor-subtitle.subtitle",[m("span",t.attrs.label)]),m(MultipleChoice,{value:n(t.attrs.name).value(),onchange:function(e){n(t.attrs.name).update(e)}}),m(".admin-feedback-questions-info","lorum-ipusum")]),m(".editor-column",[m(".editor-subtitle.subtitle",[m("span","Toelichting")]),m(TextArea,{value:n(t.attrs.name+" explanation").value(),onchange:function(e){n(t.attrs.name+" explanation").update(e)}})])])}}},TodoList=function(){return{view:function(n){return m(".admin",[m(".admin-header",[m(".admin-title.subtitle",[m("span","Voortgangs Sessies")]),0<ptrn("#"+vm.user().node+" role:leader effort type:0 effort",function(e){return e.value()}).length?m(".admin-tasks",[ptrn("feedbacksession",function(e){return m(".admin-tasks-feedback",{class:(t=e,ptrn("#"+vm.user().node+" role:leader effort type:0 effort",function(e){return e("feedback:"+t.value()).id()}).indexOf(-1)<0?"state-done":""),onclick:function(){n.attrs.onfeedback(e)}},"Voortgang "+e.value());var t}).reverse().emptyState(m(".selectorlist-state.state-empty","Geen Voorgangs sessies om in te vullen"))]):[],m(".admin-title.subtitle",[m("span","Goedkeuring")]),0<ptrn("#"+vm.user().node+" role:leader program",function(e){return e}).length?m(".admin-tasks",[(e=function(e){return m(".admin-tasks-approval",{onclick:function(){vm.program(e("task")("program")),vm.task(e("task")),vm.effort(e),vm.focus(vm.program()),vm.page(0)}},e.value())},ptrn("#"+vm.user().node+" role:leader program task effort mode:-2",function(e){return e("effort")}).map(e)).emptyState(m(".selectorlist-state.state-empty","Alle Inspanningen zijn goedgekeurd!"))]):[]])]);var e}}},CalendarOptions=function(){return{view:function(e){return m(".optionbar.calendar-optionbar",[m(".calendar-options",[m(".calendar-sub-navigation",[m(".sub-navigation-label","Weergave")]),m(".optionbar-option",{class:1===e.attrs.currentView?"state-selected":"",onclick:function(){e.attrs.setView(1)}},"Uren per week"),m(".optionbar-option",{class:2===e.attrs.currentView?"state-selected":"",onclick:function(){e.attrs.setView(2)}},"Deadlines")]),m(".calendar-options",[m(".calendar-sub-navigation",[m(".sub-navigation-label","Ga Naar")]),m(".calendar-options",[m(".optionbar-option",{onclick:function(){e.attrs.setDate(FuzzyDate.prevMonth(new Date))}},"Deze Week")])])])}}},HoursCalendar=function(){var r={w:100,h:100,scale:1,margin:2,opentime:0,closetime:0,gridheight:40};function o(e){var t=e.getBoundingClientRect();r.w=t.width,r.h=t.height,r.margin=.02*t.width,console.log(r),m.redraw()}function a(e,t){1===r.scale?t?e.attrs.setDate(FuzzyDate.nextWeek(r.opentime)):e.attrs.setDate(FuzzyDate.prevWeek(r.opentime)):t?e.attrs.setDate(FuzzyDate.nextMonth(r.opentime)):e.attrs.setDate(FuzzyDate.prevMonth(r.opentime))}return{view:function(t){var e,n;return"person"===vm.focus().type()&&(r.gridheight=vm.focus()("plannable").value()),"program"===vm.focus().type()&&(r.gridheight=vm.focus()("task effort person plannable",function(e){return parseInt(e.value())}).reduce(function(e,t){return e+t},0)),"task"===vm.focus().type()&&(r.gridheight=vm.focus()("effort hours",function(e){return parseInt(HoursSpent.Parse(e.value()).hours)}).reduce(function(e,t){return e+t},0)),"effort"===vm.focus().type()&&(r.gridheight=vm.focus()("hours",function(e){return parseInt(HoursSpent.Parse(e.value()).hours)}).reduce(function(e,t){return e+t},0)),e=t.attrs.currentDate,n=t.attrs.currentScale,r.opentime=FuzzyDate.getMonday(e),r.scale=n,r.closetime=1===n?FuzzyDate.nextKwarter(r.opentime):FuzzyDate.nextYear(r.opentime),m(".calendar",[m(".calendar-hours-range",r.gridheight),m("svg",{oncreate:function(e){o(e.dom),window.addEventListener("resize",function(){o(e.dom)})},onmousewheel:function(e){a(t,0<=e.wheelDelta)},onDOMMouseScroll:function(e){a(t,0<=e.detail)}},0<r.gridheight?[m(CalendarGrid,{p:r}),m(CalendarHours,{p:r}),m(CalendarThisWeekLine,{p:r})]:[]),m(CalendarLabels,{p:r,ondrag:function(e){a(t,0<e)}})])}}},CalendarHours=function(){return{view:function(s){var t,n=s.attrs.p.opentime;"person"===vm.focus().type()?t=vm.focus()("hours",function(e){return{effort:e("effort"),startdate:e("effort")("startdate").value(),enddate:e("effort")("enddate").value(),hours:[HoursSpent.Parse(e.value())]}}).reduce(function(e,t){var n=e.find(function(e){return ptrn.compare(e.effort,t.effort)});return n?n.hours=n.hours.concat(t.hours):e.push(t),e},[]):"effort"===vm.focus().type()?t=vm.focus()("hours",function(e){return{effort:e("person"),startdate:e("effort")("startdate").value(),enddate:e("effort")("enddate").value(),hours:[HoursSpent.Parse(e.value())]}}).reduce(function(e,t){var n=e.find(function(e){return ptrn.compare(e.effort,t.effort)});return n?n.hours=n.hours.concat(t.hours):e.push(t),e},[]):"program"===vm.focus().type()&&(t=vm.focus()("task effort",function(e){return{effort:e,startdate:e("startdate").value(),enddate:e("enddate").value(),hours:e("hours",function(e){return HoursSpent.Parse(e.value())})}}));var l=s.attrs.p.margin,c=(s.attrs.p.w-2*l)/12;return ArrayFromRange(0,11).map(function(r){var o=n,a=0,i=0,u=-1,e=t.map(function(n){return 0<n.hours.length&&u++,n.hours.map(function(e){if(FuzzyDate.inRange(n.startdate,n.enddate,o)){e.hours=parseInt(e.hours),i+=e.hours;var t=e.hours*(s.attrs.p.h/s.attrs.p.gridheight);return a+=t,m("rect.calendar-block",{class:"color-"+u%4+" "+(ptrn.compare(vm.hover(),n.effort)?"state-selected":""),x:r*c+l+.5,y:s.attrs.p.h-a,width:c+.5,height:t,onmouseover:function(){vm.hover(n.effort),m.redraw()},onmouseout:vm.unhover})}return[]})});return i>s.attrs.p.gridheight&&e.push(m("rect.calendar-block-overshoot",{x:r*c+l+.5,y:0,width:c+.5,height:s.attrs.p.h/80})),n=1===s.attrs.p.scale?FuzzyDate.nextWeek(n):FuzzyDate.nextMonth(n),e})}}},CalendarGrid=function(){return{view:function(e){for(var t=[],n=e.attrs.p.margin,r=(e.attrs.p.w-2*n)/12,o=e.attrs.p.h/e.attrs.p.gridheight,a=0;a<12;a++)for(var i=0;i<e.attrs.p.gridheight;i++)t.push(m("rect.calendar-grid",{x:a*r+1+n,y:i*o+1,width:r-1,height:o-1}));return t}}},CalendarThisWeekLine=function(){return{view:function(e){var t=e.attrs.p.h,n=e.attrs.p.margin,r=(e.attrs.p.w-2*n)/12,o=mapDatePosition(e.attrs.p,FuzzyDate.getMonday(new Date));return m("rect.calendar-todayline",{x:o,y:0,width:r+1,height:t})}}};function mapDatePosition(e,t){var n=e.opentime.getTime(),r=e.closetime.getTime(),o=r-n;o=(r+=o/48)-(n-=o/48);var a=e.w;return(t.getTime()-n)*(a/o)+0}var LinearCalendar=function(){var a={w:100,h:100,scale:1,margin:2,opentime:0,closetime:0};function i(e){var t=e.getBoundingClientRect();a.w=t.width,a.h=t.height,a.margin=.02*t.width,console.log(a),m.redraw()}function u(e,t){1===a.scale?t?e.attrs.setDate(FuzzyDate.nextWeek(a.opentime)):e.attrs.setDate(FuzzyDate.prevWeek(a.opentime)):t?e.attrs.setDate(FuzzyDate.nextMonth(a.opentime)):e.attrs.setDate(FuzzyDate.prevMonth(a.opentime))}return{view:function(t){var e,n,r,o=-1;return e=t.attrs.currentDate,n=t.attrs.currentScale,1===(a.scale=n)?(a.opentime=FuzzyDate.getMonday(e),a.closetime=FuzzyDate.nextKwarter(a.opentime)):(a.opentime=FuzzyDate.getFirstDayOfMonth(e),a.closetime=FuzzyDate.nextYear(a.opentime)),m(".calendar",[m("svg",{oncreate:function(e){i(e.dom),window.addEventListener("resize",function(){i(e.dom)})},onmousewheel:function(e){u(t,0<=e.wheelDelta)},onDOMMouseScroll:function(e){u(t,0<=e.detail)}},[m(CalendarLines,{p:a}),m(CalendarTodayLine,{p:a}),(r=function(e){return o++,m(CalendarTimeLine,{p:a,offsetTop:t.attrs.scrollTop,top:o,effort:e})},"program"===vm.focus().type()?vm.program()("task effort",r):"task"===vm.focus().type()?vm.task()("effort",r):"effort"===vm.focus().type()?r(vm.effort()):"person"===vm.focus().type()?vm.person()("effort",r):void 0)]),m(CalendarLabels,{p:a,ondrag:function(e){u(t,0<e)}})])}}},CalendarLabels=function(){var u=["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];var r=!1,o=0;return document.addEventListener("mouseup",function(){r=!1},!1),{view:function(n){return m(".calendar-labels",{onmousedown:function(e){r=!0,o=e.clientX},onmousemove:function(e){if(r){var t=o-e.clientX;50<t&&(n.attrs.ondrag(1),o=e.clientX),t<-50&&(n.attrs.ondrag(-1),o=e.clientX)}}},[m(".calendar-navbutton",{onclick:function(){n.attrs.ondrag(-1)}},m("i.material-icons","keyboard_arrow_left")),function(e){var o=e.attrs.p.opentime,a=0;if(1===e.attrs.p.scale){var i=-1;return ArrayFromRange(0,11).map(function(e){var t=FuzzyDate.currentWeek(o),n="";i!==o.getMonth()&&(i=o.getMonth(),n=u[o.getMonth()],a=i%2);var r={week:"week "+t,date:o.getDate(),month:n,phase:a};return o=FuzzyDate.nextWeek(o),r})}var r=-1;return ArrayFromRange(0,11).map(function(e){var t="";r!==o.getFullYear()&&(r=o.getFullYear(),a=(t=r)%2);var n={week:u[o.getMonth()],date:"",month:t,phase:a};return o=FuzzyDate.nextMonth(o),n})}(n).map(function(e){return m(".calendar-label",[m(".calendar-label-week",e.week),m(".calendar-label-month",{class:1===e.phase?"calendar-label-phase-a":"calendar-label-phase-b"},e.month),m(".calendar-label-date",e.date)])}),m(".calendar-navbutton",{onclick:function(){n.attrs.ondrag(1)}},m("i.material-icons","keyboard_arrow_right"))])}}},CalendarTimeLine=function(){return{view:function(e){var t=e.attrs.p.w,n=150*e.attrs.top+20-e.attrs.offsetTop,r=FuzzyDate.toRange(e.attrs.effort("startdate").value()),o=FuzzyDate.toRange(e.attrs.effort("enddate").value());r[0]&&-864e13===r[0].getTime()&&(r[1]=void 0),o[0]&&-864e13===o[0].getTime()&&(o[0]=new Date(o[1]),o[1]=void 0);var a=[void 0,void 0,void 0,void 0];return r[1]?(a[0]=mapDatePosition(e.attrs.p,r[0]),a[1]=mapDatePosition(e.attrs.p,r[1])):r[0]&&(a[1]=mapDatePosition(e.attrs.p,r[0])),o[1]?(a[2]=mapDatePosition(e.attrs.p,o[0]),a[3]=mapDatePosition(e.attrs.p,o[1])):o[0]&&(a[2]=mapDatePosition(e.attrs.p,o[0])),[void 0!==a[0]?m("line.calendar-timeline-dashed",{x1:a[0],y1:n,x2:a[1],y2:n}):[],void 0!==a[1]&&void 0!==a[2]?m("line.calendar-timeline",{x1:a[1],y1:n,x2:a[2],y2:n}):[],void 0!==a[3]?m("line.calendar-timeline-dashed",{x1:a[2],y1:n,x2:a[3],y2:n}):[],0<a[1]?m("circle.calendar-timeline",{cx:a[1],cy:n,r:5}):[],a[2]<t?m("circle.calendar-timeline",{cx:a[2],cy:n,r:5}):[]]}}},CalendarTodayLine=function(){return{view:function(e){var t=e.attrs.p.h,n=mapDatePosition(e.attrs.p,new Date);return m("line.calendar-todayline",{x1:n,y1:0,x2:n,y2:t})}}},CalendarLines=function(){return{view:function(e){for(var t=[],n=e.attrs.p.margin,r=(e.attrs.p.w-2*n)/12,o=e.attrs.p.h,a=0;a<13;a++)t.push(m("line.calendar-lines",{x1:a*r+n,y1:0,x2:a*r+n,y2:o}));return t}}},PersonalEfforts=function(){return{view:function(t){return m(".personal-efforts",{onscroll:function(e){t.attrs.onscroll(e.target.scrollTop)}},[(e=function(e){return m(".personal-efforts-effort.state-selectable",{class:ptrn.compare(vm.hover(),e.effort)?"state-selected":"",onmouseover:function(){vm.hover(e.effort),m.redraw()},onmouseout:vm.unhover},[m(Numbering,{node:e.effort,whole:!0,disabled:"_/_/_"===e.effort("startdate").value()}),m(".personal-efforts-effort-details",[m(".personal-efforts-effort-name",e.effort.value()),1!==t.attrs.currentView||"person"!==vm.focus().type()&&"effort"!==vm.focus().type()?[]:m(DateEditor,{element:e}),2===t.attrs.currentView?m(DateVisible,{element:e}):[],m(NavWidget,{node:e.effort})])])},"person"===vm.focus().type()?vm.focus()("effort",function(e){return{effort:e,hours:e("hours",function(e){return e}).filter(function(e){return-1<e("#"+vm.focus().id()).id()})}}).reduce(function(e,t){var n=e.find(function(e){return ptrn.compare(e.effort,t.effort)});return n?n.hours=n.hours.concat(t.hours):e.push(t),e},[]).map(e):"effort"===vm.focus().type()?vm.focus()("person",function(e){return{effort:e,hours:e("hours",function(e){return e}).filter(function(e){return-1<e("#"+vm.focus().id()).id()})}}).reduce(function(e,t){var n=e.find(function(e){return ptrn.compare(e.effort,t.effort)});return n?n.hours=n.hours.concat(t.hours):e.push(t),e},[]).map(e):"program"===vm.focus().type()?vm.focus()("task effort",function(e){return{effort:e,hours:e("hours",function(e){return e})}}).map(e):void 0)]);var e}}},DateVisible=function(){return{view:function(n){return m(".personal-efforts-effort-date",[m("span","van"),m(DateDisplay,{onclick:function(e){n.attrs.setDate(e[0])},date:n.attrs.element.effort("startdate").value()}),m("span","t/m"),m(DateDisplay,{onclick:function(e){var t=e[0];e[1]&&(t=e[1]),n.attrs.setDate(t)},date:n.attrs.element.effort("enddate").value()})])}}},DateEditor=function(){return{view:function(e){return console.log(e.attrs),[e.attrs.element.hours.map(function(e){var t=HoursSpent.Parse(e.value());return m(".personal-efforts-effort-date",parseInt(t.hours))})]}}},DashboardDistribution=function(){var u={w:100,h:100,m:40};function n(e){var t=e.getBoundingClientRect();u.w=t.width,u.h=t.height,m.redraw()}return{view:function(e){var a=function(e){for(var t=e,n=0;n<t.length;n++)t[n]||(t[n]=0);return t}(e.attrs.series),i=a.reduce(function(e,t){return Math.max(e,t)}),t=Math.max(0,i.toString().length-2),r=Math.floor(i/Math.pow(10,t));return[m(".dashboard-distribution",[m(".distribution-name",e.attrs.label),m("svg",{oncreate:function(e){n(e.dom),window.addEventListener("resize",function(){n(e.dom)})}},[m("rect.distribution-back",{x:u.m,y:0,width:u.w-u.m,height:u.h-u.m}),ArrayFromRange(0,r).map(function(e){e*=i/r;var t=u.h-u.m,n=e/i*t;return m("text.distribution-label-y",{x:u.m-5,y:t-n},e)}),a.map(function(e,t){var n=(u.w-u.m)/a.length,r=u.h-u.m,o=e;return e=e/i*r,[m("g",[m("rect.distribution-rect",{x:t*n+u.m,y:r-e,width:n,height:e,class:0===t?"dragon":""}),m("text.distribution-label-value",{x:t*n+n/2+u.m,y:r-e+15},o)]),m("text.distribution-label-x",{x:t*n+n/2+u.m,y:r+15},t)]}),m("text.distribution-name-x",{x:u.w/2,y:u.h-5},e.attrs.labelx),m("text.distribution-name-y",{x:15,y:u.h/2,transform:"rotate(270 15,"+u.h/2+")"},e.attrs.labely)])])]}}},DashboardHistogram=function(){return{view:function(e){var t=e.attrs.series.map(function(e){return e[1]}).reduce(function(e,t){return Math.max(e,t)});return[m(".dashboard-histogram",[e.attrs.series.map(function(e){return m(".histogram-set",[m(".histogram-set-value",0<e[1]?m(".histogram-set-value-bar",{style:"width:"+e[1]/t*100+"%;"},e[1]):m(".histogram-set-value-bar-null",0)),m(".histogram-set-label",e[0])])})])]}}},FeedbackResults=function(){return{view:function(e){return m(".dashboard-feedbacks",[ptrn("feedbacksession",function(e){var t=ptrn("feedback:"+e.value(),function(e){return[e("effects").value(),e("products").value(),e("planning").value(),e("stakeholders").value(),e("conditions").value()].reduce(function(e,t){return e[t]||(e[t]=0),e[t]++,e},{})}).reduce(function(e,t){for(var n in t)e[n]||(e[n]=0),e[n]+=t[n];return e},{0:0,1:0,2:0,"":0});return{name:e.value(),totals:(t[0]||0)+(t[1]||0)+(t[2]||0)+(t[""]||0),values:t}}).map(function(e){return m(".dashboard-feedbacks-session",[m(".dashboard-feedbacks-session-name",e.name),m(".dashboard-feedbacks-session-values",[0<e.values[0]?m(".dashboard-feedbacks-session-value.feedback-color-a",{style:"height:"+e.values[0]/e.totals*100+"%;"},[m(Icon,{name:"feedback-top-white-small"}),m("span",(e.values[0]/e.totals*100).toFixed(1)+"%")]):[],0<e.values[1]?m(".dashboard-feedbacks-session-value.feedback-color-b",{style:"height:"+e.values[1]/e.totals*100+"%;"},[m(Icon,{name:"feedback-low-white-small"}),m("span",(e.values[1]/e.totals*100).toFixed(1)+"%")]):[],0<e.values[2]?m(".dashboard-feedbacks-session-value.feedback-color-c",{style:"height:"+e.values[2]/e.totals*100+"%;"},[m(Icon,{name:"feedback-middle-white-small"}),m("span",(e.values[2]/e.totals*100).toFixed(1)+"%")]):[],0<e.values[""]?m(".dashboard-feedbacks-session-value.feedback-color-d",{style:"height:"+e.values[""]/e.totals*100+"%;"},""):[]])])})])}}},GeneralStatus=function(){return{view:function(e){return m(".dashboard-feedbacks",[ptrn("program",function(e){return m(".dashboard-general-program",[m(".dashboard-general-program-name",e.value()),m(".dashboard-general-tasks",e("task",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e){return m(".dashboard-general-task",[m(".dashboard-general-task-number",e("order").value()),e("effort",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e){return m(".dashboard-general-effort",{class:-1==e("mode").value()?"mode-sketch":" "+e("mode").value()==-2?"mode-ready":""},e("order").value())})])}))])})])}}},KeywordOverview=function(){return{view:function(e){return m(".keywords-wrapper",m(".keywords",GetKeywords().map(function(e){return m(".keywords-block",[m(".keywords-letter",e.letter),e.words.map(function(e){return m(Keyword,e)})])})))}}},Keyword=function(){var t=!1;return{view:function(e){return m(".keywords-keyword",{onclick:function(){t=!t}},[m(".keywords-word",{class:t?"selected":""},e.attrs.word),t?m(".keyword-relations",e.attrs.refs.map(function(e){return m(".keyword-relation",{onclick:function(){"program"===e.type()&&(vm.program(e),vm.focus(e)),"task"===e.type()&&(vm.program(e("program")),vm.task(e),vm.focus(vm.program())),"effort"===e.type()&&(vm.program(e("task program")),vm.task(e("task")),vm.effort(e),vm.focus(vm.program())),vm.page(0)}},[m(Numbering,{node:e,whole:!0}),e.value()])})):[]])}}},MatrixStatus=function(){return{view:function(e){return m(".dashboard-feedbacks",[m(".dashboard-general-top",ptrn("program",function(e){return m(".dashboard-general-program-top",[m(".dashboard-general-program-top-name",e.value())])})),m(".dashboard-general-bottom",ptrn("program",function(e){return m(".dashboard-general-program",[m(".dashboard-general-program-name",e.value()),m(".dashboard-general-tasks",e("task",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e){return m(".dashboard-matrix-task",[m(".dashboard-matrix-task-number",e("order").value()),ptrn("program",function(t){return m(".dashboard-matrix-task-program",[e("related effort",function(e){return e}).filter(function(e){return ptrn.compare(t,e("task program"))}).map(function(e){return m(".dashboard-matrix-task-program-effort",e("task order").value())})])})])}))])}))])}}},Statistics=function(){var t=1,n=0,r=[{list:"program",count:["program","task","task effort","task effort person","task effort person hours"]},{list:"task",count:["program","task","effort","effort person","effort person hours"]},{list:"effort",count:["task program","task","effort","person","hours"]},{list:"person",count:["effort task program","effort task","effort","person","hours"]}];return{view:function(e){return m(".dashboard-statistics",[m(".dashboard-query",[m("span","Aantal "),m(DropDown,{value:t,options:["programma's","opgaven","inspanningen","mensen","uren"],onchange:function(e){t=e}}),m("span"," per "),m(DropDown,{value:n,options:["programma","opgave","inspanning","persoon"],onchange:function(e){n=e}})]),m(DashboardHistogram,{series:ptrn(r[n].list,function(e){return 4===t?[e.value(),e(r[n].count[t],function(e){return e}).filter(function(e){var t=e("effort"),n=e("person");if(-1<t.id()&&-1<n.id()){var r=FuzzyDate.getMonday(new Date);return FuzzyDate.inRange(t("startdate").value(),t("enddate").value(),r)}return!1}).map(function(e){return parseInt(HoursSpent.Parse(e.value()).hours)}).reduce(function(e,t){return e+t},0)]:[e.value(),e(r[n].count[t],function(e){return e}).length]}).sort(function(e,t){return t[1]-e[1]})})])}}},ConnectionEditor=function(){var t,r;return{view:function(n){return[n.attrs.state?m(".editor-connectionlist.box-editor-style",[m(".editor-connectionlist-list",[ptrn("program",function(e){return m(".editor-connectionlist-item.item-list",{class:ptrn.compare(t,e)?"state-selected":"",onclick:function(){t=e}},[m(".editor-connectionlist-item-number",m(Numbering,{node:e})),m(".editor-connectionlist-item-name",e.value())])})]),m(".editor-connectionlist-list",[t?t("task",function(e){return m(".editor-connectionlist-item.item-list",{class:ptrn.compare(r,e)?"state-selected":"",onclick:function(){r=e,vm.edit()("related").id()<0&&ptrn.createrelate("related","",vm.edit()),ptrn.speculativeRelate(vm.edit()("related"),e),r=t=void 0,n.attrs.onchange()}},[m(".editor-connectionlist-item-number",m(Numbering,{node:e})),m(".editor-connectionlist-item-name",e.value()),m("i.material-icons .connectionlist-addbutton","add")])}):[]])]):[],m(".editor-connections-parents",[vm.edit()("related task",function(t){return m(".editor-connections-parent.state-selected",[m(Numbering,{node:t,whole:!0}),m(".editor-connections-parent-name.body-text",t.value()),m("span.icon-button.editor-removefrom-list",[m("i.material-icons",{onclick:function(e){ptrn.speculativeUnrelate(vm.edit()("related"),t),n.attrs.onchange()}},"close"),m("span.icon-button-hint","Verwijderen")])])}).emptyState(n.attrs.state?[]:m(".editor-empty-list",[ArrayFromRange(0,1).map(function(e){return m(".editor-empty-list-item",[m(".editor-empty-list-item-number",""),m(".editor-empty-list-item-number",""),m(".editor-empty-list-item-number",""),m(".editor-empty-list-item-name"+(e%2==1?"-short":""),""),m(".editor-empty-list-item-delete","")])}),m(".button.button-empty-list",{onclick:n.attrs.onopen},"Gedeelde opgaven toevoegen")]))])]}}},Editor=function(){return{view:function(e){return m(".editor",{class:(vm.edit()?"state-edit":"state-hidden")+" "+(vm.edit()&&"effort"!==vm.edit().type()?"editor-left":"editor-right")},[vm.edit()?m(".editor-header",[m(Numbering,{node:vm.edit()}),m("span",["effort"===vm.edit().type()?"Inspanning Editor":[],"task"===vm.edit().type()?"Opgave Editor":[],"program"===vm.edit().type()?"Programma Editor":[],"person"===vm.edit().type()?"Gebruiker Editor":[]]),m(".icons-header",[m(".button",{onclick:function(){ptrn.transact(),"effort"===vm.edit().type()?vm.effort(vm.edit()):"task"===vm.edit().type()?vm.task(vm.edit()):"program"===vm.edit().type()&&vm.program(vm.edit()),vm.editClose()}},["Opslaan"]),m(".close-button.icon-button",{onclick:function(){var e=!0;ptrn.hasSpeculations()&&(!0===confirm("Wijzigingen niet opslaan?")?ptrn.unSpeculate():e=!1),e&&("effort"===vm.edit().type()?vm.effort(vm.edit()):"task"===vm.edit().type()?vm.task(vm.edit()):"program"===vm.edit().type()&&vm.program(vm.edit()),vm.editClose())}},[m("span.icon-button-hint","Wijzigingen annuleren"),m("i.material-icons","close")])])]):[],vm.edit()?m(".editor-content",{onbeforeremove:function(e){return new Promise(function(e){setTimeout(e,400)})}},["effort"===vm.edit().type()?m(EffortEditor):"task"===vm.edit().type()?m(TaskEditor):"program"===vm.edit().type()?m(ProgramEditor):"person"===vm.edit().type()?m(UserEditor):void 0,m(".editor-buttons",["task"===vm.edit().type()||"effort"===vm.edit().type()||"person"===vm.edit().type()&&0===vm.user().role?m(".button-delete",{onclick:function(){var e;!0===confirm("Weet je zeker dat je '"+vm.edit().value()+"' wil verwijderen?")&&("task"===vm.edit().type()&&(e=vm.edit()("program"),vm.edit().drop(),e("task",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e,t){console.log(e("order").update(t+1))})),"effort"===vm.edit().type()&&(e=vm.edit()("task"),vm.edit().drop(),e("effort",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e,t){console.log(e("order").update(t+1))})),"person"===vm.edit().type()&&(ptrn.dropuser(vm.edit().id(),function(){}),vm.edit().drop(),ptrn.transact()),vm.editClose(),ptrn.transact())}},"Verwijder"):[]])]):[]])}}},EffortEditor=function(){var n=!1,t=!1,r=!1;return{view:function(e){return m(".efforteditor",[m(".editor-section",[m(".editor-section-title.title","Beschrijving"),m(".editor-row",[m(".editor-column.editor-title-editor",[m(".editor-subtitle.subtitle",[m("span","Inspanning titel"),m(InfoBox,{content:"Kies een korte en herkenbare titel"})]),m(TextArea,{value:vm.edit().value(),onchange:function(e){vm.edit().update(e)}})]),m(".editor-column",[m(".editor-subtitle.subtitle",[m("span","Type"),m(InfoBox,{content:m("ul",[m("li","Een routine is een activiteit die zich perodiek herhaalt."),m("li","Een project heeft een begin en einde.")])})]),m(TypeEditor,{type:parseInt(vm.edit()("type").value()),onchange:function(e){vm.edit()("type").update(e)}})])]),m(".editor-row",[m(".editor-column",[m(".editor-subtitle.subtitle",[m("span","Beoogd Effect"),m(InfoBox,{content:m("",[m("span","Datgene wat uiteindelijk bereikt wordt, bijvoorbeeld:"),m("ul",[m("li","vermindering armoede"),m("li","...")])])})]),m(TextArea,{value:vm.edit()("description").value(),onchange:function(e){vm.edit()("description").update(e)}})]),m(".editor-column",[m(".editor-subtitle.subtitle",[m("span","Eindproduct"),m(InfoBox,{content:m("",[m("span","Datgene wat uiteindelijk wordt opgeleverd, bijvoorbeeld:"),m("ul",[m("li","Een rapport"),m("li","...")])])})]),m(TextArea,{value:vm.edit()("endproduct").value(),onchange:function(e){vm.edit()("endproduct").update(e)}})])])]),m(".editor-section",[m(".editor-section-title.title","Positionering"),m(".editor-subtitle-header",[m(".editor-subtitle.subtitle",[m("span","Gerelateerde opgaven"),m(InfoBox,{content:m("",[m("span","Als een inspanning gedeeld wordt door meerdere programma's kun je dat hier aangeven")])})]),m("span.icon-button.icons-header",[m("span.icon-button-hint",r?"Toevoegen annuleren":"Inspanning aan andere opgave verbinden"),m("i.material-icons",{onclick:function(e){r=!r}},r?"close":"add")])]),m(ConnectionEditor,{state:r,onopen:function(){r=!0},onchange:function(){r=!1}})]),m(".editor-section",[m(".editor-section-title.title","Planning"),m(".editor-subtitle.subtitle",[m("span","Periode"),m(InfoBox,{content:m("",[m("span","Als er geen precieze datum bekend is, geef dan alleen een schatting")])})]),m(".editor-selection-date",[m("span.body-text","van"),m(DatePicker,{value:vm.edit()("startdate").value(),onchange:function(e){console.log("update: "+e),vm.edit()("startdate").update(e)}})]),m(".editor-selection-date",[m("span.body-text","t/m"),m(DatePicker,{value:vm.edit()("enddate").value(),onchange:function(e){console.log("update: "+e),vm.edit()("enddate").update(e)}})])]),m(".editor-section",[m(".editor-section-title.title","Mensen"),m(".editor-subtitle-header",[m(".editor-subtitle.subtitle",[m("span","Opdrachtgevers"),m(InfoBox,{content:m("",[m("span","Bestuurlijk en Ambtelijk Opdrachtgevers")])})]),m("span.icon-button.icons-header",[m("span.icon-button-hint",t?"Toevoegen annuleren":"Opdrachtgever toevoegen"),m("i.material-icons",{onclick:function(e){t=!t}},t?"close":"add")])]),m(PeopleListEditor,{classname:"client-editor",peoplelist:vm.edit()("role:aclient person",function(e){return e}).concat(vm.edit()("role:bclient person",function(e){return e})),roles:{selected:function(e){return 0<e("role:bclient #"+vm.edit().id()).id()?0:-1},options:["Bestuurlijk Opdrachtgever"],novalue:"Ambtelijk Opdrachtgever",onchange:function(e,t){0===e?(ptrn.speculativeUnrelate(vm.edit(),t("role:aclient")),ptrn.speculativeRelate(vm.edit(),t("role:bclient"))):(ptrn.speculativeUnrelate(vm.edit(),t("role:bclient")),ptrn.speculativeRelate(vm.edit(),t("role:aclient")))}},emptystate:"Opdrachtgevers toevoegen",onopen:function(){t=!0},onadd:function(e){vm.edit()("role:bclient #"+e.id()).id()<0&&ptrn.speculativeRelate(vm.edit(),e("role:aclient")),t=!1},ondelete:function(e){0<e("role:aclient #"+vm.edit().id()).id()?ptrn.speculativeUnrelate(vm.edit(),e("role:aclient")):ptrn.speculativeUnrelate(vm.edit(),e("role:bclient"))},state:t}),m(".editor-subtitle-header",[m(".editor-subtitle.subtitle",[m("span","Team"),m(InfoBox,{content:m("",[m("span","Alle mensen die meewerken aan deze inspanning. Een persoon is de trekker.")])})]),m("span.icon-button.icons-header",[m("span.icon-button-hint",n?"Toevoegen annuleren":"Teamlid toevoegen"),m("i.material-icons",{onclick:function(e){n=!n}},n?"close":"add")])]),m(PeopleListEditor,{classname:"team-editor",state:n,peoplelist:vm.edit()("person",function(e){return e}),roles:{selected:function(e){return 0<e("role:leader #"+vm.edit().id()).id()?0:-1},options:["Trekker"],novalue:"Teamlid",onchange:function(e,t){0===e?ptrn.speculativeRelate(vm.edit(),t("role:leader")):ptrn.speculativeUnrelate(vm.edit(),t("role:leader"))}},emptystate:"Team samenstellen",onopen:function(){n=!0},onadd:function(t){vm.edit()("#"+t.id()).id()<0&&(ptrn.speculativeRelate(vm.edit(),t),vm.edit()("hours #"+t.id()).id()<0&&ptrn.create("hours","~/_/_-~/_/_-0-~-w-0-w",function(e){ptrn.speculativeRelate(e,vm.edit()),ptrn.speculativeRelate(e,t)}),1===vm.edit()("person",function(e){return e}).length&&ptrn.speculativeRelate(vm.edit(),t("role:leader"))),n=!1},ondelete:function(e){ptrn.speculativeUnrelate(vm.edit(),e)},planhours:!0})]),m(".editor-section.editor-section-end",[m(".status-content",[m(Toggle,{value:vm.edit()("mode").value(),label_sketch:"Concept",label_submitted:"Voorleggen",label_definitive:"Goedgekeurd",onchange:function(e){vm.edit()("mode").update(e)}})])])])}}},PeopleListEditor=function(){var t="",e=[];return{view:function(o){return m(".editor-peoplelist",{class:o.attrs.classname},[o.attrs.state?[m("input.input.editor-peoplelist-searchbar",{class:o.attrs.state?"":"state-hidden",oncreate:function(e){e.dom.focus()},placeholder:"Voornaam Achternaam",onkeydown:m.withAttr("value",function(e){t=e}),onkeyup:m.withAttr("value",function(e){t=e}),value:t}),m("i.material-icons.editor-peoplelist-searchbar-icon","search"),m(".editor-peoplelist-finder.box-editor-style",[0<t.length?m(FilteredPeopleList,{value:t,allownew:!0,onadd:function(e){t="",o.attrs.onadd(e)}}):m(TeamList,{onadd:function(e){o.attrs.onadd(e)}})])]:[],0<o.attrs.peoplelist.length?m(".editor-peoplelist-navigation",[o.attrs.planhours?m(".editor-peoplelist-section.sub-navigation-label","Uur per week"):[],o.attrs.noroles?[]:m(".editor-peoplelist-section.sub-navigation-label","Positie")]):[],o.attrs.peoplelist.map(function(t){var n,r=t("hours",function(e){return e}).filter(function(e){return-1<e("#"+vm.edit().id()).id()});return n=r[0]?HoursSpent.Parse(r[0].value()):void 0,m(".editor-peoplelist-person",[m("span.editor-peoplelist-person-name.body-text",t.value()),o.attrs.planhours?[m(".editor-hours-week",[m(NumberRoller,{value:n?parseInt(n.hours):"~",oninput:function(e){n.hours=""+e,r[0].update(HoursSpent.toString(n)),m.redraw()}})]),m("span.editor-peoplelist-person-switch-planning",{onclick:function(){-1<e.findIndex(function(e){return e===t.value()})?e=e.filter(function(e){return e!==t.value()}):e.push(t.value()),console.log(e)}},[m("span","Planning"),m("i.material-icons",-1<e.findIndex(function(e){return e===t.value()})?"keyboard_arrow_up":"keyboard_arrow_down")])]:[],o.attrs.noroles?[]:m(DropDown,{value:o.attrs.roles.selected(t),options:o.attrs.roles.options,novalue:o.attrs.roles.novalue,onchange:function(e){o.attrs.roles.onchange(e,t)}}),m("span.icon-button.editor-peoplelist-person-remove",[m("i.material-icons",{onclick:function(){o.attrs.ondelete(t)}},"close"),m("span.icon-button-hint","Verwijderen")]),-1<e.findIndex(function(e){return e===t.value()})?[m(PeopleHoursCompare,{person:t,parsedhours:n})]:[]])}).emptyState(o.attrs.state?[]:m(".editor-empty-list",[ArrayFromRange(0,5).map(function(e){return m(".editor-empty-list-item",[m(".editor-empty-list-item-name"+(e%2==1?"-short":""),""),m(".editor-empty-list-item-label",""),m(".editor-empty-list-item-label",""),m(".editor-empty-list-item-delete","")])}),m(".button.button-empty-list",{onclick:o.attrs.onopen},o.attrs.emptystate)])),0<o.attrs.peoplelist.length&&o.attrs.planhours?m(".total-hours",[m(".title-total","Totaal uur"),m(".total-hours-counting",o.attrs.peoplelist.reduce(function(e,t){var n=t("hours",function(e){return e}).filter(function(e){return-1<e("#"+vm.edit().id()).id()});if(n[0]){var r=HoursSpent.Parse(n[0].value());return e+parseInt(r.hours)}return e},0))]):[]])}}},PeopleHoursCompare=function(){return{view:function(e){var u=e.attrs.person("contract").value(),s=FuzzyDate.getMonday(new Date),l=(0,e.attrs.person)("hours",function(e){return{effort:e("effort"),startdate:e("effort")("startdate").value(),enddate:e("effort")("enddate").value(),hours:[HoursSpent.Parse(e.value())]}}).reduce(function(e,t){var n=e.find(function(e){return ptrn.compare(e.effort,t.effort)});return n?n.hours=n.hours.concat(t.hours):e.push(t),e},[]);return console.log(l),m(".editor-peoplehours",{},[ArrayFromRange(0,11).map(function(e){var n=s,r=0,o=0;l.map(function(t){return 0<t.hours.length&&0,t.hours.map(function(e){FuzzyDate.inRange(t.startdate,t.enddate,n)&&(e.hours=parseInt(e.hours),ptrn.compare(t.effort,vm.edit())&&(o+=e.hours),r+=e.hours)})});var t=FuzzyDate.currentWeek(s);s.getDate(),s.getMonth();s=FuzzyDate.nextWeek(s);var a=r/u*100,i=o/u*100;return m(".editor-peoplehours-week",[m(".editor-peoplehours-hours",{style:"height: "+(100<a?100:a)+"%;",class:100<a?"editor-peoplehours-hours-overflow":""}),m(".editor-peoplehours-currenthours",{style:"height: "+(100<i?100:i)+"%;",class:100<a?"editor-peoplehours-hours-overflow":""}),m(".editor-peoplehours-label","week "+t)])})])}}},ProgramEditor=function(){var t=!1;return{view:function(e){return m(".efforteditor",[m(".editor-section",[m(".editor-section-title.title","Beschrijving"),m(".editor-row",[m(".editor-column.editor-title-editor",[m(".editor-subtitle",[m("span","Programma titel")]),m(TextArea,{value:vm.edit().value(),onchange:function(e){vm.edit().update(e)}})]),m(".editor-column",[m(".editor-subtitle",[m("span","Categorie"),m(InfoBox,{content:"Betreft het een horizontaal of een verticaal programma?"})]),m(ProgramTypeEditor,{selected:vm.edit()("domain"),onchange:function(e){e&&(ptrn.speculativeUnrelate(vm.edit(),vm.edit()("domain")),ptrn.speculativeRelate(vm.edit(),e))}})])]),m(".editor-row",[m(".editor-subtitle",[m("span","Missie"),m(InfoBox,{content:"Wat is de missie van dit programma?"})]),m(TextArea,{value:vm.edit()("mission").value(),onchange:function(e){vm.edit()("mission").update(e)}})]),m(".editor-row",[m(".editor-subtitle-header",[m(".editor-subtitle.subtitle",[m("span","Programma Leider"),m(InfoBox,{content:m("",[m("span","Leider van het programma")])})]),m(".icons-header",[m("span.icon-button.icons-header",[m("span.icon-button-hint","Nieuwe programma leider toevoegen"),m("i.material-icons",{onclick:function(e){t=!t}},"add")])])]),m(PeopleListEditor,{peoplelist:vm.edit()("role:leader person",function(e){return e}),noroles:!0,roles:{selected:function(e){return 0<e("role:leader #"+vm.edit().id()).id()?0:-1},options:["Programma Leider"],novalue:"-",onchange:function(e,t){0===e?ptrn.speculativeRelate(vm.edit(),t("role:leader")):ptrn.speculativeUnrelate(vm.edit(),t("role:leader"))}},emptystate:"Programma leider toevoegen",onopen:function(){t=!0},onadd:function(e){ptrn.speculativeRelate(vm.edit(),e("role:leader")),t=!1},ondelete:function(e){ptrn.speculativeUnrelate(vm.edit(),e("role:leader"))},state:t})])])])}}},ProgramTypeEditor=function(){return{view:function(t){return m(".editor-typeselect",[ptrn("domain",function(e){return m(".editor-typeselect-type",{class:ptrn.compare(t.attrs.selected,e)?"state-selected":"",onclick:function(){t.attrs.onchange(e)}},[m(".editor-typeselect-type-name",e.value())])})])}}},TaskEditor=function(){return{view:function(e){return m(".efforteditor",[m(".editor-section",[m(".editor-section-title.title","Beschrijving"),m(".editor-row.editor-title-editor",[m(".editor-column",[m(".editor-subtitle",[m("span","Opgave titel"),m(InfoBox,{content:"Een opgave, doel of 'wolkje'"})]),m(TextArea,{value:vm.edit().value(),onchange:function(e){vm.edit().update(e)}})]),m(".editor-column",[m(".editor-subtitle",[m("span","door..."),m(InfoBox,{content:"Je opgave wordt geformuleerd als '... door ...'."})]),m(TextArea,{value:vm.edit()("means").value(),onchange:function(e){vm.edit()("means").update(e)}})])])]),m(".editor-section",[m(".editor-section-title.title","Resultaten"),m(".editor-row",[m(".editor-subtitle",[m("span","Indicator"),m(InfoBox,{content:"Een indicator geeft meetbaar aan of het doel gehaald wordt"}),m("span.icon-button.icons-header",[m("span.icon-button-hint","Nieuwe indicator toevoegen"),m("i.material-icons",{onclick:function(e){ptrn.createrelate("kpi","",vm.edit())}},"add")])]),m(KPIEditor,{onadd:function(e){ptrn.createrelate("kpi","",vm.edit())}})])]),m(".editor-section.editor-section-end",[])])}}},KPIEditor=function(){return{view:function(e){return vm.edit()("kpi",function(t){return m(".kpiEdit",[m("span","- "),m(TextArea,{value:t.value(),onchange:function(e){t.update(e)}}),m("span.icon-button",[m("i.material-icons",{onclick:function(e){t.drop()}},"close"),m("span.icon-button-hint","Verwijderen")])])}).emptyState(e.attrs.state?[]:m(".editor-empty-list",[ArrayFromRange(0,3).map(function(e){return m(".editor-empty-list-item",[m(".editor-empty-list-item-name"+(e%2==1?"-short":""),""),m(".editor-empty-list-item-label",""),m(".editor-empty-list-item-label",""),m(".editor-empty-list-item-delete","")])}),m(".button.button-empty-list",{onclick:e.attrs.onadd},"Indicator toevoegen")]))}}},TypeEditor=function(){return{view:function(n){return m(".editor-typeselect",[viewModels.typeNames.map(function(e,t){return m(".editor-typeselect-type",{class:n.attrs.type===t?"state-selected":"",onclick:function(){n.attrs.onchange(t)}},[m(".editor-typeselect-type-name",e)])})])}}},UserEditor=function(){var n=0===vm.user().role,r=vm.userlist().find(function(e){return e.node===vm.edit().id()});return{onremove:function(){console.log("onbeforeremove"),console.log("save",r),n&&r&&ptrn.updateuser(r.node,r.name,r.role,function(){vm.updateUserList()})},view:function(e){var t=vm.edit();return m(".efforteditor",[m(".editor-section",[m(".editor-section-title.title","Beschrijving"),m(".editor-row.editor-title-editor",[m(".editor-subtitle",[m("span","Naam"),m(InfoBox,{content:"Je voornaam en achternaam"})]),m(TextArea,{value:t.value(),onchange:function(e){t.update(e)}})]),n&&r?m(".editor-row.editor-title-editor",[m(".editor-subtitle",[m("span","Email"),m(InfoBox,{content:"Email Adres"})]),m(TextArea,{value:r.name,onchange:function(e){r.name=e}})]):[],n&&r?m(".editor-row.editor-title-editor",[m(".editor-subtitle.subtitle",[m("span","Type"),m(InfoBox,{content:m("ul",[m("li","Een routine is een activiteit die zich perodiek herhaalt."),m("li","Een project heeft een begin en einde.")])})]),m(UserTypeEditor,{type:r.role,onchange:function(e){r.role=e}})]):[]]),m(".editor-section",[m(".editor-section-title.title","Contract"),m(".editor-row",[m(".editor-subtitle",[m(".editor-subtitle",[m("span","Contract"),m(InfoBox,{content:"Je contract uren, en hoeveel daarvan inplanbaar zijn"})]),m("div",[m(NumberRoller,{value:parseInt(t("contract").value()),oninput:function(e){t("contract").update(e),m.redraw()}}),m("span","uur per week, waarvan"),m(NumberRoller,{value:parseInt(t("plannable").value()),oninput:function(e){t("plannable").update(e),m.redraw()}}),m("span","uur inplanbaar")])])])])])}}},UserTypeEditor=function(){return{view:function(n){return m(".editor-typeselect",[["Gebruiker","Beheerder"].map(function(e,t){return m(".editor-typeselect-type",{class:n.attrs.type===t-1?"state-selected":"",onclick:function(){n.attrs.onchange(t-1)}},[m(".editor-typeselect-type-name",e)])})])}}},DropdownNav=function(){var t,n=0,r="";function o(){t.attrs.onpick(),r=""}return{view:function(e){return t=e,n=0<r.length?-1:0,[e.attrs.state?[m("div.dropdown-outside",{onclick:function(){o()}}),m(".programnav-popup",{},[m(".programnav-searchbar",[m("input",{placeholder:"Zoeken naar ...",value:r,oninput:m.withAttr("value",function(e){r=e}),oncreate:function(e){e.dom.focus()}})]),-1===n?m(".programnav-domain",[ptrn("*"+r,function(e){return e}).filter(function(e){return-1<["program","task","effort","person"].indexOf(e.type())}).sort(function(e,t){return["person","program","task","effort"].indexOf(e.type())-["person","program","task","effort"].indexOf(t.type())}).map(function(e){return m(".state-selectable.programnav-searchresult",{class:"searchresult-"+e.type(),onclick:function(){"program"===e.type()&&(vm.program(e),vm.focus(e),o()),"task"===e.type()&&(vm.program(e("program")),vm.task(e),vm.focus(vm.program()),o()),"effort"===e.type()&&(vm.program(e("task program")),vm.task(e("task")),vm.effort(e),vm.focus(vm.program()),o()),"person"===e.type()&&(vm.person(e),vm.focus(e),o())}},[m(".programnav-searchresult-number",m(Numbering,{whole:!0,node:e})),m(".programnav-searchresult-title",e.value())])})]):[],0===n?[m(".programnav-domain",[m(".programnav-domain-name","CONTACT"),m(".state-selectable.programnav-program",m("a.programnav-program-title",{href:"mailto:planlab@eindhoven.nl"},"planlab@eindhoven.nl"))]),ptrn("domain",function(e){return m(".programnav-domain",[m(".programnav-domain-name",e.value()),e("program",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e){return m(".state-selectable.programnav-program.default",{class:ptrn.compare(vm.program(),e)?"state-selected":"",onclick:function(){vm.program(e),vm.focus(e),vm.page(0),o()}},[m(".programnav-program-number",m(Numbering,{node:e})),m(".programnav-program-title",e.value())])})])}),m(".programnav-domain",[m(".programnav-domain-name","MENSEN"),ptrn("person",function(e){return e}).sort(function(e,t){var n=e.value().toLowerCase(),r=t.value().toLowerCase();return n<r?-1:r<n?1:0}).map(function(e){return m(".state-selectable.programnav-program",{class:ptrn.compare(vm.person(),e)?"state-selected":"",onclick:function(){vm.person(e),vm.closeall(),vm.focus(e),o()}},[m(".programnav-program-title",e.value())])})])]:[]])]:[]]}}},Login=function(){var o="",t="",a=!1;function n(){ptrn.loginuser(o,function(e){e?(a=!1,vm.login(2)):a=!0,m.redraw()})}function r(){ptrn.loginpass(o,t,function(e,t,n,r){e?(a=!1,vm.login(0),vm.user({user:o,node:t,role:n,token:r}),ptrn.onload(function(){vm.person(ptrn("person"))})):a=!0,m.redraw()})}return{view:function(e){return 0<vm.login()?m(".login",[m(".login-overlay-fullscreen"),m(".login-popup",[m(".login-popup-title.title","Hallo! Welkom bij Planlab 🙋"),1===vm.login()?[m("input.login-popup-email",{type:"email",name:"email",placeholder:"E-mail adres",oninput:m.withAttr("value",function(e){o=e}),onchange:m.withAttr("value",function(e){o=e}),onkeydown:function(e){13===e.keyCode&&n()},value:o}),a?m(".login-popup-error-message.body-text","Onbekend email adres"):[],m(".login-buttons",[m(".button",{onclick:function(){n()}},"Verder"),m(".button",{onclick:function(){vm.login(1),o=""}},"Annuleer")])]:2===vm.login()?[m(".login-popup-email",o),m(".login-popup-message.body-text","We hebben u een email gestuurd met een tijdelijk wachtwoord. Controleer alstublieft uw inbox."),m("input.login-popup-email",{placeholder:"Uw tijdelijke wachtwoord",oninput:m.withAttr("value",function(e){t=e}),onchange:m.withAttr("value",function(e){t=e}),onkeydown:function(e){13===e.keyCode&&r()},value:t}),a?m(".login-popup-error-message.body-text","Dit wachtwoord is onbekend, probeer opnieuw..."):[],m(".login-buttons",[m(".button",{onclick:function(){r()}},"Inloggen"),m(".button",{onclick:function(){t=o="",vm.login(1)}},"Annuleer")])]:void 0,m(".login-popup-forgotten",["Kan je niet inloggen? Neem contact op met ",m("a",{href:"mailto:planlab@eindhoven.nl"},"planlab@eindhoven.nl")])])]):[]}}},NavBar=function(){var t=!1;function n(){var e=ptrn("feedbacksession",function(t){var e=ptrn("#"+vm.user().node+" role:leader effort type:0 effort",function(e){return e("feedback:"+t.value()).id()});return 0<e.length&&e.indexOf(-1)<=0}).reduce(function(e,t){return t&&e++,e},0);return e+=ptrn("#"+vm.user().node+" role:leader program task effort mode:-2",function(e){return e("effort")}).length}return{view:function(e){return m("nav",[m(".programnav",[m(".nav-button",{onclick:function(){vm.page(2)}},[m(Icon,{name:"general",selected:2===vm.page()}),m(".nav-tooltip","Dashboard")]),m(".nav-button",{onclick:function(){vm.page(0)}},[m(Icon,{name:"programma-cloud",selected:0===vm.page()}),m(".nav-tooltip","Doelenboom")]),m(".nav-button",{onclick:function(){vm.page(1)}},[m(Icon,{name:"kalendar",selected:1===vm.page()}),m(".nav-tooltip","Kalender")]),m(".nav-current-position",{onclick:function(){t=!t}},[void 0!==vm.focus()&&4!==vm.page()?["person"!==vm.focus().type()?m(".nav-program-number",m(Numbering,{node:vm.focus(),selected:!0})):m(".nav-button",m(Icon,{name:"personal",selected:!0})),m(".nav-program-title-top",vm.focus().value())]:[4===vm.page()?[m(".nav-program-number",m(".nav-button",m(Icon,{name:"personal",selected:!0}))),m(".nav-program-title-top",ptrn("#"+vm.user().node).value())]:[m(".nav-program-number",m(".nav-button",m(Icon,{name:"personal",selected:!0}))),m(".nav-program-title-top","Sociaal Domein")]]]),m(".programnav-dropdown-icon",{onclick:function(){t=!t}},m("i.material-icons",t?"keyboard_arrow_up":"keyboard_arrow_down"))]),m(DropdownNav,{state:t,onpick:function(){t=!1}}),m(".nav-right",[m(".nav-connecting",vm.connecting()?[m("span","laden "),m(".smallloading","")]:[]),m(".nav-user",{onclick:function(){0===vm.login()?vm.page(4):vm.login(1)}},[0===vm.login()?[m(".nav-user-login",m(Icon,{name:"personal",selected:!0})),m(".nav-user-name",ptrn("#"+vm.user().node).value()),0<n()?m(".nav-user-todo",n()):[]]:[m(".nav-user-login",m(Icon,{name:"personal",selected:!1}))]])])])}}},DateDisplay=function(){return{view:function(e){return m("span.date-display",{onclick:function(){e.attrs.onclick&&e.attrs.onclick(FuzzyDate.toRange(e.attrs.date))}},FuzzyDate.toReadableString(e.attrs.date))}}},DatePicker=function(){var n=[{value:!1},{value:!1},{value:!1}],r=!1;function o(){r=!1}function a(e){e.attrs.onchange(FuzzyDate.toString(n))}function i(e){return!1===e.value?"Geen":e.label}return{view:function(t){var e;return e=t.attrs.value,n=FuzzyDate.toArray(e),m(".datepicker",[m(".datepicker-value",{onclick:function(){r=!r}},[m(".datepicker-navigation",[m(".datepicker-section.year.sub-navigation-label","Jaar"),m(".datepicker-section.sub-navigation-label","Maand/Kwartaal"),m(".datepicker-section.sub-navigation-label","Dag/Periode")]),m(".datepicker-date",[m(".datepicker-section.year",i(n[0])),m(".datepicker-section",i(n[1])),m(".datepicker-section",i(n[2]))])]),r?m(".datepicker-menu.box-editor-style",[m(".datepicker-column.year",[FuzzyDate.years.map(function(e){return e.splitter?m(".datepicker-splitter",""):m(".datepicker-option.item-list",{class:n[0].value===e.value?"state-selected":"",onclick:function(){n[0]=e,n[1]={value:!1},n[2]={value:!1},a(t),e.p||o()}},i(e))})]),m(".datepicker-column",{class:n[0].p?"active":"disabled"},[FuzzyDate.months.map(function(e){return e.splitter?m(".datepicker-splitter",""):m(".datepicker-option.item-list",{class:n[1].value===e.value?"state-selected":"",onclick:function(){n[0].p&&(n[1]=e,n[2]={value:!1},a(t),e.p||o())}},i(e))})]),m(".datepicker-column",{class:n[1].p?"active":"disabled"},[FuzzyDate.days.map(function(e){return e.splitter?m(".datepicker-splitter",""):m(".datepicker-option.item-list",{class:n[2].value===e.value?"state-selected":"",onclick:function(){n[1].p&&(n[2]=e,a(t),o())}},i(e))})])]):[]])}}},DateWeekSelector=function(){var r,o,a=!1;return{view:function(t){var e=FuzzyDate.toRange(t.attrs.date);e[0]?(r||(r=FuzzyDate.currentYear(e[0])),o||(o=FuzzyDate.currentWeek(e[0]))):(r=FuzzyDate.currentYear(new Date),o=FuzzyDate.currentWeek(new Date));var n=FuzzyDate.currentWeek(new Date("12/31/"+r));return 1===n&&(n=FuzzyDate.currentWeek(new Date("12/24/"+r))),m("span.dateweek-selector",[m("span.dateweek-selector-date",{onclick:function(){a=!a}},e[1]?"week "+FuzzyDate.currentWeek(e[1])+" - "+FuzzyDate.currentYear(e[1]):[e[0]?"week "+FuzzyDate.currentWeek(e[0])+" - "+FuzzyDate.currentYear(e[0]):"Onbekend"]),a?m(".dateweek-selector-dropdown",[m(NumberRoller,{value:parseInt(r),oninput:function(e){r=e,m.redraw()}}),m(".dateweek-selector-dropdown-weeks",ArrayFromRange(1,n).map(function(e){return m(".dateweek-selector-dropdown-week",{class:o===e?"state-selected":"",onclick:function(){o=e,a=!1,t.attrs.oninput(FuzzyDate.StringfromDate(FuzzyDate.getDateOfWeek(o,r)))}},e)}))]):[]])}}},DropDown=function(){var r=!1;return{view:function(n){return m(".dropdown",[m("div.dropdown-value",{class:void 0!==n.attrs.value?"":"novalue",onclick:function(){r=!r}},-1!==n.attrs.value?n.attrs.options[n.attrs.value]:n.attrs.novalue),r?[m("div.dropdown-outside",{onclick:function(){r=!1}}),m("div.dropdown-options.box-editor-style",[[n.attrs.novalue].concat(n.attrs.options).map(function(e,t){return m(".dropdown-option.item-list",{class:0===t?"novalue":"",onclick:function(){r=!1,n.attrs.onchange(t-1)}},e)})])]:[]])}}},FilteredPeopleList=function(){return{view:function(t){var n,e=(n=t.attrs.value,ptrn("person",function(e){return e}).filter(function(e){return-1<e.value().toLowerCase().indexOf(n.toLowerCase())}).map(function(e){return e.displayName=StringHighlight(e.value(),n),e}));return 0<e.length?m(".personlist",e.map(function(e){return m(".personlist-person",{onclick:function(){t.attrs.onadd(e)}},[e.displayName,m("i.material-icons .person-list-add-button","add")])})):m(".personlist",m(".personlist-noresults","Geen resultaten"))}}},Icon=function(){var t=!1,n=!1;return{view:function(e){return void 0!==e.attrs.selected&&(t=e.attrs.selected),m("img.icon",{src:"/icons/planlab-icon-"+e.attrs.name+(t||n?"-hover":"")+".svg",onmouseover:function(){n=!0,m.redraw()},onmouseout:function(){n=!1,m.redraw()}})}}},InfoBox=function(){return{view:function(e){return m("div.info-box",[m(Icon,{name:"info"}),m("div.info-box-popup.box-editor-style",e.attrs.content)])}}},MultipleChoice=function(){return{view:function(e){return m(".mulitiplechoice",[m(".mulitiplechoice-choice",{onclick:function(){e.attrs.onchange("0")}},m(Icon,{name:"feedback-top",selected:"0"===e.attrs.value})),m(".mulitiplechoice-choice",{onclick:function(){e.attrs.onchange("1")}},m(Icon,{name:"feedback-low",selected:"1"===e.attrs.value})),m(".mulitiplechoice-choice",{onclick:function(){e.attrs.onchange("2")}},m(Icon,{name:"feedback-middle",selected:"2"===e.attrs.value}))])}}},NavWidget=function(){function t(e){"effort"===e.type()&&(vm.program(e("task")("program")),vm.task(e("task")),vm.effort(e),vm.focus(e)),"person"===e.type()&&(vm.person(e),vm.effort()&&-1!==vm.effort()("#"+e.id()).id()||(vm.taskClose(),vm.effortClose()),vm.focus(e))}return{view:function(e){return m(".navwidget",[m(".navwidget-view",{onclick:function(){t(e.attrs.node),vm.page(2)}},m(Icon,{name:"general-small"})),m(".navwidget-view",{onclick:function(){t(e.attrs.node),vm.page(0)}},m(Icon,{name:"programma-cloud-small"})),m(".navwidget-view",{onclick:function(){t(e.attrs.node),vm.page(1)}},m(Icon,{name:"kalendar-small"}))])}}},Numbering=function(){return{view:function(e){var t=e.attrs.node,n=t.type();return e.attrs.whole?"program"===n?m(".numbering",[m(".numbering-number-small",t("order").value())]):"task"===n?m(".numbering",[m(".numbering-number-small",t("program")("order").value()),m(".numbering-number-small",t("order").value())]):"effort"===n?m(".numbering",{class:(e.attrs.disabled?"state-disabled ":" ")+(e.attrs.selected?"state-selected":"")},[m(".numbering-number-small",t("task")("program")("order").value()),m(".numbering-number-small",t("task")("order").value()),m(".numbering-number-small",t("order").value())]):[]:m(".numbering",{class:e.attrs.selected?"state-selected":""},[m(".numbering-number",t("order").value())])}}},NumberRoller=function(){var a;return{view:function(o){return m("input.numberroller",{value:void 0!==a?a:o.attrs.value,oninput:function(e){a=parseInt(e.target.value),isNaN(a)&&(a=0),o.attrs.oninput(""+a)},onmousedown:function(e){var n=o.attrs.value;a=n,downpoint=e.screenY;var t=function(e){e.preventDefault(),e.returnValue=!1;var t=downpoint-e.screenY;(a=n+Math.round(t/10))<0&&(a=0),o.attrs.oninput(a)},r=function(e){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",r),a=void 0};document.addEventListener("mousemove",t),document.addEventListener("mouseup",r)}},void 0!==a?a:o.attrs.value)}}};function StringHighlight(e,t){var n=e.toLowerCase().indexOf(t.toLowerCase());return[m("span",e.slice(0,n)),m("span.search-result-highlight",e.slice(n,n+t.length)),m("span",e.slice(n+t.length,e.length))]}var TeamList=function(){return{view:function(t){return m(".personlist",ptrn("program",function(n){return m(".personlist-team",{oncreate:function(e){if(ptrn.compare(vm.program(),n)){var t=e.dom.offsetTop;e.dom.parentNode.scrollTop=t}}},[m(".personlist-teamname",n.value()),n("task effort person",function(e){return m(".personlist-person.item-list",{onclick:function(){t.attrs.onadd(e)}},[e.value(),m("i.material-icons .person-list-add-button","add")])}).emptyState(m(".personlist-team-emptystate.state-empty","nog geen toegewezen team"))])}))}}},TextArea=function(){var n=0;return{view:function(t){return m("textarea.box-editor-style.textarea[wrap=hard]",{oninput:m.withAttr("value",function(e){t.attrs.onchange(e)}),onchange:m.withAttr("value",function(e){t.attrs.onchange(e)}),value:t.attrs.value,oncreate:function(e){e.attrs.autofocus&&setTimeout(function(){e.dom.focus()},10)},onbeforeupdate:function(e,t){n=t.dom.selectionStart},onupdate:function(e){e.dom.selectionStart=n,e.dom.selectionEnd=n}})}}},Toggle=function(){return{view:function(e){return m("div.toggle",["-1"<vm.edit()("task program role:leader #"+vm.user().node).id()&&"-2"===e.attrs.value?[m(".status-labels",{class:"state-off",onclick:function(){e.attrs.onchange("-1")}},"Afkeuren"),m(".status-labels",{class:"state-off",onclick:function(){e.attrs.onchange("0")}},"Goedkeuren")]:[m(".status-labels",{class:"-1"===e.attrs.value?"state-on":"state-off",onclick:function(){e.attrs.onchange("-1")}},e.attrs.label_sketch),m(".status-labels",{class:"-2"===e.attrs.value||"0"===e.attrs.value?"state-on":"state-off",onclick:function(){e.attrs.onchange("-2")}},"0"===e.attrs.value?e.attrs.label_definitive:e.attrs.label_submitted)]])}}},EffortSelector=function(){var n=0;function r(){return"program"===vm.focus().type()&&0<vm.task()("related",function(e){return e}).length}return{view:function(e){return vm.task()?m(".selector",[m(".selector-header",[m("span","Inspanningen"),"program"===vm.focus().type()?m(".icons-header",[m("span.selector-tooltip","Nieuwe Inspanning"),m("i.material-icons",{onclick:function(){createnew.effort()}},"add")]):[]]),m(".selectorlist",{onbeforeupdate:function(e,t){n=t.dom.scrollTop},onupdate:function(e){e.dom.scrollTop=n}},[m(".selectorlist-back",{class:r()?"selectorlist-back-nostretch":""},[(t=function(e){return ptrn.compare(vm.create(),e)?m(CreateEffortSelectorItem,{effort:e}):m(EffortSelectorItem,{effort:e})},"program"===vm.focus().type()?vm.task()("effort",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(t):"task"===vm.focus().type()?vm.task()("effort",t):"effort"===vm.focus().type()?[t(vm.focus())]:"person"===vm.focus().type()?vm.task()("effort",function(e){return e}).filter(function(e){return-1<e("#"+vm.person().id()).id()}).map(t):void 0).emptyState(m(EffortSelectorEmptyState))]),r()?m(".selectorlist-related",[m(".selector-subtitle","Gerelateerde Inspanningen"),vm.task()("related effort",function(e){return m(EffortSelectorItem,{effort:e,related:!0})})]):[]])]):[];var t}}},EffortSelectorEmptyState=function(){return{view:function(e){return[ArrayFromRange(0,3).map(function(e){return m(".selectorlist-item-grey",[m(".selectorlist-item-number-grey",""),m(".selectorlist-item-content",[m(".selectorlist-item-line-grey",""),m(".selectorlist-item-line-short-grey",""),m(".selectorlist-item-line-grey",""),m(".selectorlist-item-line-short-grey","")])])}),m(".selectorlist-emptystate",[m(".selectorlist-emptystate-message-header","Top! 👍"),m(".selectorlist-emptystate-message","Deze opgave heeft geen inspanningen. Is er dan écht niets te doen?"),m(".selectorlist-emptystate-button.button",{onclick:function(){createnew.effort()}},"Nieuwe inspanning"),m(".selectorlist-emptystate-message","Klik op de + in de rechterbovenhoek om een nieuwe inspanning toe te voegen")])]}}},EffortSelectorItem=function(){function n(e,t){vm.task()("effort",function(e){return e}).length;var n=e("order"),r=vm.task()("effort",function(e){return e}).filter(function(e){return e("order").value()===parseInt(n.value())+t})[0];r&&(ptrn.unrelate(e,n),ptrn.relate(e,r("order")),ptrn.unrelate(r,r("order")),ptrn.relate(r,n),ptrn.transact())}return{view:function(e){var t=e.attrs.effort;return m(".state-selectable.selectorlist-item",{class:(ptrn.compare(vm.effort(),t)?"state-selected":"")+" "+("0"===t("mode").value()?"":"mode-sketch")},[m(".selectorlist-item-number",{onclick:function(){vm.effort(t)}},[m(Numbering,{node:t,whole:e.attrs.related})]),m(".selectorlist-item-content",{onclick:function(){vm.effort(t)}},[m(".selector-selected-title",t.value().emptyState(m(".selectorlist-state.state-empty","Inspanning zonder titel"))),m(".selectorlist-item-labels",[-1==t("mode").value()?m(".selectorlist-item-label-position","Concept"):[],-2==t("mode").value()?m(".selectorlist-item-label-position","Voorgelegd"):[]]),m(".selectorlist-item-options",["program"===vm.focus().type()&&!0!==e.attrs.related?m(".selectorlist-item-options-position",[m(".selectorlist-item-option.icon-button-grey",{onclick:function(e){e.stopPropagation(),window.event.cancelBubble=!0,n(t,1)}},[m("i.material-icons","keyboard_arrow_down"),m("span.selector-tooltip-bottom","Volgorde veranderen")]),m(".selectorlist-item-option.icon-button-grey",{onclick:function(e){e.stopPropagation(),window.event.cancelBubble=!0,n(t,-1)}},[m("i.material-icons","keyboard_arrow_up"),m("span.selector-tooltip-bottom","Volgorde veranderen")])]):[],m(".selectorlist-item-option.icon-button-grey.selectorlist-item-option-edit",{onclick:function(){vm.edit(t)}},[m(Icon,{name:"edit"}),m("span.selector-tooltip-bottom","Inspanning bewerken")])])]),m(".selector-hidden",[m(".selector-selected-type",emptyState(viewModels.typeNames[t("type").value()],m(".state-empty","Nog geen type"))),m(".selector-selected-subheader.subtitle","Beoogd Effect"),m(".selector-selected-description.body-text",t("description").value().emptyState(m(".effortselector-description-state.state-empty","Nog geen beoogd effect"))),m(".selector-selected-subheader.subtitle","Eindproduct"),m(".selector-selected-description.body-text",t("endproduct").value().emptyState(m(".selector-selected-description.state-empty","Nog geen eindproduct"))),m(".selector-selected-subheader.subtitle","Mensen"),m(".selector-selected-description.body-text",t("person",function(e){return m(".selector-selected-peoplelist.body-text",{class:ptrn.compare(t("role:leader person"),e)?"selector-selected-peoplelist-person-leader":""},[m("span.selector-selected-peoplelist-person",e.value()),m("span.selector-selected-peoplelist-icons",[m(NavWidget,{node:e})])])}).emptyState(m(".selector-selected-description.state-empty","Nog geen mensen"))),m(".selector-selected-subheader.subtitle","Periode"),m(".selector-selected-description.body-text",[m("span.selector-selected-period-label.body-text","van"),m(DateDisplay,{date:t("startdate").value()}),m("span.selector-selected-period-label.body-text","t/m"),m(DateDisplay,{date:t("enddate").value()})])])])}}},CreateEffortSelectorItem=function(){function t(e){var t=!0;0<e.value().length&&(!0===confirm("Wijzigingen niet opslaan?")?ptrn.unSpeculate():t=!1),t&&(ptrn.unSpeculate(),vm.createClose())}function n(e){vm.createClose(),ptrn.transact(),vm.effort(e)}function r(e){vm.createClose(),vm.edit(e)}return{view:function(e){return m(InplaceEditor,{placeholder:"Inspanning titel invoeren",element:e.attrs.effort,onclose:t,onsave:n,onmore:r})}}},HomepageSelector=function(){return{view:function(e){return m(".homepageselector",[ptrn("domain",function(e){return m(".programnav-domain.homepageselector-domain",[m(".programnav-domain-name",e.value()),e("program",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e){return m(".state-selectable.programnav-program.default",{class:ptrn.compare(vm.program(),e)?"state-selected":"",onclick:function(){vm.program(e),vm.focus(e),vm.page(0)}},[m(".programnav-program-number",m(Numbering,{node:e})),m(".programnav-program-title",e.value())])})])})])}}},InplaceEditor=function(){return{view:function(e){var t=e.attrs.element;return[m(".state-selectable.selectorlist-item",{class:"state-selected"},[m(".selectorlist-item-number",{onclick:function(){selectItem(t)}},[m(Numbering,{node:t})]),m(".selectorlist-item-content",[m("textarea.selector-selected-title",{rows:1,value:t.value(),oninput:function(e){t.update(e.target.value)},oncreate:function(e){var t=e.dom;function n(){t.style.height="auto",t.style.height=t.scrollHeight+"px"}function r(){window.setTimeout(n,0)}window.attachEvent?observe=function(e,t,n){e.attachEvent("on"+t,n)}:observe=function(e,t,n){e.addEventListener(t,n,!1)},observe(t,"change",n),observe(t,"cut",r),observe(t,"paste",r),observe(t,"drop",r),observe(t,"keydown",r),t.focus(),t.select(),n()},placeholder:e.attrs.placeholder}),m(".button.selector-inplace-editor-button.button.selector-inplace-editor-button-options",{onclick:function(){e.attrs.onmore(t)}},"Meer opties"),m(".button.selector-inplace-editor-button",{onclick:function(){e.attrs.onsave(t)}},"Opslaan"),m(".button.selector-inplace-editor-button.selector-inplace-editor-button-cancel",{onclick:function(){e.attrs.onclose(t)}},"Annuleren")])])]}}},MissionVision=function(){return{view:function(e){return m(".mission",[m(".selector-header",[m("span","Missie"),m("span.icon-button.icons-header",{onclick:function(e){vm.edit(vm.program())}},[m("span.icon-button-hint","Programma Details Bewerken"),m(Icon,{name:"edit"})])]),""!==vm.program()("mission").value()?[m(".mission-mission body-text",vm.program()("mission").value())]:m(".mission-mission",[m(".selectorlist-emptystate",[m(".selectorlist-emptystate-message",[m("em",vm.program().value())," heeft nog geen missie."]),m(".selectorlist-emptystate-button.button",{onclick:function(){vm.edit(vm.program())}},"Missie toevoegen"),m(".selectorlist-emptystate-message",["Klik op het sleuteltje om de details van het programma te bewerken"])])])])}}},ProgramDetails=function(){var t=!1;return{view:function(e){if(0<viewModels.Hierarchy.getProgram())return m(".programdetails",[m(".programdetails-title",Models.Task.getParent().name),m(".icons-header",[m("i.material-icons.edit-button",{class:t?"":"state-hidden",onclick:function(){viewModels.editMode.set("program",Models.Task.getParent())}},"build"),m("i.material-icons",{onclick:function(){t=!t}},t?"arrow_drop_up":"arrow_drop_down")]),m(".programdetails-mission",{class:t?"":"state-hidden"},Models.Task.getParent().mission)])}}},ProgramNav=function(){var t=!1;return{view:function(e){return m(".programnav",{},[m(".programnav-topbar.state-selected",{onclick:function(){0!==vm.page()&&vm.program()?vm.page(0):t=!t}},[0===vm.page()&&vm.program()?[m(".programnav-program-number",m(Numbering,{node:vm.program()})),m(".programnav-program-title-top",vm.program().value())]:[],m("i.material-icons.programnav-dropdown",t?"arrow_drop_up":"arrow_drop_down")]),t?m(".programnav-popup",{},[ptrn("domain",function(e){return m(".programnav-domain",[m(".programnav-domain-name",e.value()),e("program",function(e){return m(".state-selectable.programnav-program",{class:ptrn.compare(vm.program(),e)?"state-selected":"",onclick:function(){vm.program(e),vm.page(0),t=!1}},[m(".programnav-program-number",m(Numbering,{node:e})),m(".programnav-program-title",e.value())])})])})]):[]])}}},ProgramTeam=function(){return{view:function(e){var t=vm.program()("role:leader person");return m(".teamlist",[m(".selector-header",[m("span","Team")]),[m(".teamlist-person.teamlist-person-leader",[m("span.teamlist-person-name",t.value()),m("span.teamlist-person-icons",[m(NavWidget,{node:t})])]),vm.program()("task effort person",function(e){return m(".teamlist-person",[m("span.teamlist-person-name",e.value()),m("span.teamlist-person-icons",[m(NavWidget,{node:e})])])})]])}}},TaskSelector=function(){return{view:function(e){return vm.focus()?m(".selector",[m(".selector-header",[m("span","Opgaven"),"program"===vm.focus().type()?m(".icons-header",[m("span.selector-tooltip","Nieuwe Opgave"),m("i.material-icons",{onclick:function(){createnew.task()}},"add")]):[]]),m(".selectorlist",m(".selectorlist-back",["program"===vm.focus().type()?vm.program()("task",function(e){return e}).sort(function(e,t){return parseInt(e("order").value())-parseInt(t("order").value())}).map(function(e){return ptrn.compare(vm.create(),e)?m(CreateTaskSelectorItem,{task:e}):m(TaskSelectorItem,{task:e})}).emptyState(m(TaskSelectorEmptyState)):[],"task"===vm.focus().type()?m(TaskSelectorItem,{task:vm.focus()}):[],"effort"===vm.focus().type()?vm.focus()("task program",function(e){return m(".selector-devider",[m(".selector-subtitle",e.value()),e("task",function(e){return e}).filter(function(e){return-1<e("#"+vm.focus().id()).id()}).map(function(e){return m(TaskSelectorItem,{task:e})})])}).emptyState(m(".selectorlist-state.state-empty","Nog geen opgaven")):[],"person"===vm.focus().type()?vm.person()("effort task program",function(e){return m(".selector-devider",[m(".selector-subtitle",e.value()),e("task",function(e){return e}).filter(function(e){return-1<e("effort #"+vm.person().id()).id()}).map(function(e){return m(TaskSelectorItem,{task:e})})])}).emptyState(m(".selectorlist-state.state-empty","Nog geen opgaven")):[]]))]):[]}}},TaskSelectorEmptyState=function(){return{view:function(e){return[ArrayFromRange(0,3).map(function(e){return m(".selectorlist-item-grey",[m(".selectorlist-item-number-grey",""),m(".selectorlist-item-content",[m(".selectorlist-item-line-grey",""),m(".selectorlist-item-line-short-grey",""),m(".selectorlist-item-line-grey",""),m(".selectorlist-item-line-short-grey","")])])}),m(".selectorlist-emptystate",[m(".selectorlist-emptystate-message-header","Oh, hallo daar! 👋"),m(".selectorlist-emptystate-message",[m("em",vm.program().value())," heeft nog geen opgaven."]),m(".selectorlist-emptystate-button.button",{onclick:function(){createnew.task()}},"Nieuwe opgave"),m(".selectorlist-emptystate-message","Klik op de + in de rechterbovenhoek om een nieuwe opgave toe te voegen")])]}}},TaskSelectorItem=function(){function n(e,t){vm.program()("task",function(e){return e}).length;var n=e("order"),r=vm.program()("task",function(e){return e}).filter(function(e){return e("order").value()===parseInt(n.value())+t})[0];r&&(ptrn.unrelate(e,n),ptrn.relate(e,r("order")),ptrn.unrelate(r,r("order")),ptrn.relate(r,n),ptrn.transact())}function r(e){console.log("select"),vm.edit()&&"effort"===vm.edit().type()?(vm.editClose(),ptrn.compare(vm.task(),e)||vm.task(e)):vm.task(e)}return{view:function(e){var t=e.attrs.task;return m(".state-selectable.selectorlist-item",{class:(ptrn.compare(vm.task(),t)?"state-selected":"")+" "+("-1"==t("mode").value()?"mode-sketch":"")},[m(".selectorlist-item-number",{onclick:function(){r(t)}},[m(Numbering,{node:t})]),m(".selectorlist-item-content",{onclick:function(){r(t)}},[m(".selector-selected-title",t.value().emptyState(m(".selectorlist-state.state-empty","Opgave zonder titel"))),m(".selectorlist-item-options",["program"===vm.focus().type()?m(".selectorlist-item-options-position",[m(".selectorlist-item-option.icon-button-grey",{onclick:function(e){return e.stopPropagation(),window.event.cancelBubble=!0,n(t,1),!1}},[m("i.material-icons","keyboard_arrow_down"),m("span.selector-tooltip-bottom","Volgorde veranderen")]),m(".selectorlist-item-option.icon-button-grey",{onclick:function(e){return e.stopPropagation(),window.event.cancelBubble=!0,n(t,-1),!1}},[m("i.material-icons","keyboard_arrow_up"),m("span.selector-tooltip-bottom","Volgorde veranderen")])]):[],m(".selectorlist-item-option.icon-button-grey.selectorlist-item-option-edit",{onclick:function(){vm.edit(t)}},[m(Icon,{name:"edit"}),m("span.selector-tooltip-bottom","Opgave bewerken")])]),""!==t("means").value()?[m("span.selector-selected-title-means-label",m("i.material-icons .selector-selected-arrow","arrow_forward")),m("span.selector-selected-title-means",t("means").value())]:[]]),m(".selector-hidden",[m(".selector-selected-subheader","Indicator"),t("kpi",function(e){return m(".selector-selected-description.kpi","- "+e.value())}).emptyState(m(".selector-selected-description.state-empty","Nog geen indicator"))])])}}},CreateTaskSelectorItem=function(){function t(e){var t=!0;0<e.value().length&&(!0===confirm("Wijzigingen niet opslaan?")?ptrn.unSpeculate():t=!1),t&&(ptrn.unSpeculate(),vm.createClose())}function n(e){vm.createClose(),ptrn.transact(),vm.task(e)}function r(e){vm.createClose(),vm.edit(e)}return{view:function(e){return m(InplaceEditor,{placeholder:"Opgave titel invoeren",element:e.attrs.task,onclose:t,onsave:n,onmore:r})}}},AdminPage=function(){var t=0,n=-1;return{view:function(e){return[m(".layout-optionbar",[m(".optionbar",[m(".optionbar-section",[m(".sub-navigation-label","Mijn gegevens"),m(".optionbar-option",{onclick:function(){t=0},class:0===t?"state-selected":""},"Taaklijst"),m(".optionbar-option",{onclick:function(){t=1},class:1===t?"state-selected":""},"Persoonlijke Gegevens")]),0===vm.user().role?m(".optionbar-section",[m(".sub-navigation-label","Functioneel Beheer"),m(".optionbar-option",{onclick:function(){t=2},class:2===t?"state-selected":""},"Gebruikers")]):[],m(".optionbar-section",[m(".sub-navigation-label","")]),m(".optionbar-option.logout",{onclick:function(){vm.logout(),vm.page(0),m.redraw()}},"Uitloggen")])]),m(".layout-workspace",[0===t?m(TodoList,{onfeedback:function(e){t=3,n=e.value()}}):[],1===t?m(Contract):[],2===t?m(AdminUsers):[],3===t?m(Feedback,{session:n,onsave:function(){t=0}}):[]]),m(".layout-right",m(Editor))]}}},CalendarPage=function(){var t=0,n=FuzzyDate.prevMonth(new Date),r=1,o=1;function a(e){void 0!==e&&(n=e)}function i(e){r=e}function u(e){o=e}return{view:function(e){return vm.focus()?[m(".layout-optionbar",m(CalendarOptions,{currentScale:r,currentView:o,setDate:a,setScale:i,setView:u})),m(".layout-workspace",[m(".layout-thincolumn",m(PersonalEfforts,{onscroll:function(e){t=e},setDate:a,currentView:o})),m(".layout-thickcolumn",[1===o?m(HoursCalendar,{scrollTop:t,currentDate:n,currentScale:r,setDate:a}):m(LinearCalendar,{scrollTop:t,currentDate:n,currentScale:r,setDate:a})])])]:[]}}},DashboardPage=function(){var t=0;return{view:function(e){return[m(".layout-optionbar",[m(".optionbar",[m(".optionbar-section",[m(".sub-navigation-label","Visualisatie"),m(".optionbar-option",{onclick:function(){t=0},class:0===t?"state-selected":""},"Statistieken"),m(".optionbar-option",{onclick:function(){t=2},class:2===t?"state-selected":""},"Status"),m(".optionbar-option",{onclick:function(){t=4},class:4===t?"state-selected":""},"Matrix"),m(".optionbar-option",{onclick:function(){t=3},class:3===t?"state-selected":""},"Woordenboek")])])]),m(".layout-workspace",[0===t?m(Statistics):[],1===t?m(FeedbackResults):[],2===t?m(GeneralStatus):[],3===t?m(KeywordOverview):[],4===t?m(MatrixStatus):[]])]}}},HelpContent=[{title:"Toegang tot planlab",content:["Om in te loggen op planlab volg je de volgende stappen.",{type:"list",content:["Ga via link naar de APP; http://planlab.wolkenmachine.nl/#!/  ","Je krijgt het verzoek je emailadres op te geven","Na opgave emailadres ontvang je een link met wachtwoord en ‘magische link’, je kunt beiden gebruiken(met de link kun je meteen door), klik hierop","Je kunt nu in de APP werken"]}]}],HelpPage=function(){return{view:function(e){return m(".help",[m(".help-nav","Planlab Help pagina"),m(".help-content",HelpContent.map(function(e){return m(".help-section",[m(".help-section-title",e.title),e.content.map(function(e){return"string"==typeof e?m(".help-section-text",e):"list"===e.type?m("ol.help-section-list",e.content.map(function(e,t){return m("li.help-section-listelem",e)})):void 0})])}))])}}},Page=function(){return{view:function(e){return[m(".layout-nav-top",[m(".layout-nav-segment",m(NavBar))]),0===vm.page()?m(TreePage):[],1===vm.page()?m(CalendarPage):[],2===vm.page()?m(DashboardPage):[],3===vm.page()?m(CalendarPage):[],4===vm.page()?m(AdminPage):[],m(".layout-overlay",m(Login))]}}},TreePage=function(){var t=1;return{view:function(e){return[m(".layout-optionbar",[m(".optionbar",[vm.focus()&&"program"===vm.focus().type()?m(".optionbar-section",[m(".sub-navigation-label","Doelenboom"),m(".optionbar-option",{onclick:function(){t=1},class:1===t?"state-selected":""},"Opgaven & Inspanningen"),m(".optionbar-option",{onclick:function(){t=0},class:0===t?"state-selected":""},"Missie & Team")]):[]])]),m(".layout-workspace",[void 0===vm.focus()?[m(HomepageSelector)]:[],vm.focus()&&"program"===vm.focus().type()&&0===t?[m(".layout-column",m(MissionVision)),m(".layout-column",m(ProgramTeam))]:[m(".layout-column",m(TaskSelector)),m(".layout-column",m(EffortSelector))],m(".layout-right",m(Editor))])]}}};