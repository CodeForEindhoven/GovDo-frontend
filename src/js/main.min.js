var config={api_endpoint:"http://localhost:8000/"},Models={},model={get:function(e,t,n){m.request({method:"GET",url:config.api_endpoint+e}).then(n)},post:function(e,t,n){m.request({method:"POST",url:config.api_endpoint+e,data:t}).then(n)}};Models.Program=function(){function e(){model.get("domain",{},function(e){r=e})}function t(t,n,o){model.post("program",{name:t,mission:n},function(t){e(),o(t.id)})}function n(t,n,o,r){model.post("program/"+t,{name:n,mission:o},function(t){e(),r(t.id)})}function o(){return r}var r=[];return{newItem:t,updateItem:n,loadContent:e,getContent:o}}(),Models.Task=function(){function e(){model.get("program/"+a,{},function(e){s=e.Tasks,c=e.name})}function t(){return s}function n(){return c}function o(t){t!==a&&(a=t,t>0&&e())}function r(t,n,o){model.post("task",{program:a,name:t,means:n},function(t){e(),o(t.id)})}function i(t,n,o,r){model.post("task/"+t,{name:n,means:o},function(t){e(),r(t.id)})}var a=-1,s=[],c="";return{newItem:r,updateItem:i,loadContent:e,getContent:t,getName:n,updateContent:o}}(),Models.Effort=function(){function e(){model.get("task/"+a,{},function(e){s=e.Efforts,c=e.name})}function t(){return s}function n(){return c}function o(t){t!==a&&(a=t,t>0&&e())}function r(t,n,o,r,i){model.post("effort",{task:a,name:t,description:n,type:o,people:r},function(t){e(),i(t.id)})}function i(t,n,o,r,i,a){model.post("effort/"+t,{name:n,description:o,type:r,people:i},function(t){e(),a(t.id)})}var a=-1,s=[],c="";return{newItem:r,updateItem:i,loadContent:e,getContent:t,getName:n,updateContent:o}}(),Models.Person=function(){function e(){model.get("people",{},function(e){i=e})}function t(){return i}function n(){model.get("teams",{},function(e){a=e})}function o(){return a}function r(t,n){model.post("person",{name:t},function(t){e(),n(t)})}var i=[],a=[];return{loadPeople:e,getPeople:t,loadTeams:n,getTeams:o,newItem:r}}(),Models.Changes=function(){function e(){model.get("changes",{},function(e){o=e.map(function(e){return e.new=!1,e.updatedAt==e.createdAt&&(e.new=!0),e.date=n(new Date(e.updatedAt)),e.task=e.Tasks[0].name,e.program=e.Tasks[0].Programs[0].name,e})})}function t(){return o}function n(e){var t=Math.floor((new Date-e)/1e3),n=Math.floor(t/31536e3);return n>1?n+" jaar":(n=Math.floor(t/2592e3))>1?n+" maanden":(n=Math.floor(t/604800))>1?n+" weken":(n=Math.floor(t/86400))>1?n+" dagen":(n=Math.floor(t/3600))>1?n+" uur":(n=Math.floor(t/60),n>1?n+" minuten":Math.floor(t)+" seconden")}var o=[];return{loadContent:e,getContent:t}}(),Models.Search=function(){function e(){model.get("search",{},function(e){n=e.map(function(e){return e.task=e.Tasks[0].name,e.program=e.Tasks[0].Programs[0].name,e})})}function t(){return n}var n=[];return{loadContent:e,getContent:t}}();var viewModels={};viewModels.Hierarchy=function(){function e(e,t){u=e,d=-1,m=-1,l=t,Models.Task.updateContent(u)}function t(){return u}function n(){return l}function o(e){d=e,m=-1,Models.Effort.updateContent(d)}function r(){return d}function i(e){m=e}function a(){return m}function s(e){console.log(e),f=e}function c(t,n,r){e(t),o(n),i(r)}var u=-1,l="",d=-1,m=-1,f=-1;return{updatePerson:s,updateProgram:e,updateTask:o,updateEffort:i,getProgram:t,getTask:r,getEffort:a,getProgramName:n,jumpTo:c}}(),viewModels.typeNames=["Project","Programma","Routine","Proces","Improvisatie","Klusje"],viewModels.editMode=function(){var e=!1,t="",n={};return{state:function(){return e},isType:function(e){return t===e},content:function(){return n},setContent:function(e,t){n[e]=t},set:function(o,r){e=!0,t=o,r&&(n=JSON.parse(JSON.stringify(r)))},close:function(){e=!1,t="",n={}},save:function(){console.log("save"),"effort"===t&&(console.log("effort"),-1===n.id?(console.log("new"),Models.Effort.newItem(n.name,n.description,n.type,n.People,function(e){viewModels.Hierarchy.updateEffort(n.id),viewModels.editMode.close()})):(console.log("update"),Models.Effort.updateItem(n.id,n.name,n.description,n.type,n.People,function(e){viewModels.Hierarchy.updateEffort(n.id),viewModels.editMode.close()})))}}}();var API_VERSION="0.1.0";model.get("",{},function(e){e.version!==API_VERSION?(console.log("out of sync!"),location.reload(!0)):m.route(document.body,"/",{"/":Page})});var Editor=function(){return{view:function(e){return m(".editor",{class:viewModels.editMode.state()?"state-edit":"state-hidden"},[function(){if(viewModels.editMode.isType("effort"))return m(EffortEditor)}(),m(".editor-buttons",[m(".button-edit",{onclick:function(){viewModels.editMode.save()}},"Opslaan"),m(".button",{onclick:function(){viewModels.editMode.close()}},"Annuleer"),m(".button-right",{onclick:function(){}},"Verwijder")])])}}},EffortEditor=function(){return{view:function(e){return m(".efforteditor",[m(".editor-subtitle","Inspanning titel"),m(TextArea,{value:viewModels.editMode.content().name,placeholder:"title",onchange:function(e){viewModels.editMode.setContent("name",e)}}),m(".editor-subtitle","Inspanning beschrijving"),m(TextArea,{value:viewModels.editMode.content().description,placeholder:"beschrijving",onchange:function(e){viewModels.editMode.setContent("description",e)}}),m(".editor-subtitle","Team"),m(PeopleListEditor,{value:viewModels.editMode.content().People,onchange:function(e){viewModels.editMode.setContent("People",e)}}),m(".editor-subtitle","Type"),m(TypeEditor,{value:viewModels.editMode.content().type,onchange:function(e){viewModels.editMode.setContent("type",e)}})])}}},PeopleListEditor=function(){return{view:function(e){return m(".editor-peoplelist",[e.attrs.value.map(function(t){return m(".editor-peoplelist-person",[m("span",t.name),m("span.editor-peoplelist-person-remove",{onclick:function(){for(var n=e.attrs.value,o=n.length-1;o>=0;o--)n[o].id===t.id&&n.splice(o,1);e.attrs.onchange(n)}},m("i",{class:"material-icons"},"close"))])})])}}},TypeEditor=function(){return{view:function(e){return m(".editor-typeselect",[viewModels.typeNames.map(function(t,n){return m(".editor-typeselect-type",{class:e.attrs.value===n?".state-selected":"",onclick:function(){e.attrs.onchange(n)}},t)})])}}},EffortSelector=function(){function e(e){return viewModels.Hierarchy.getEffort()===e}function t(t){return!viewModels.editMode.state()&&e(t)}function n(e){return!!viewModels.editMode.state()&&viewModels.editMode.content().id===e}return{view:function(o){return viewModels.Hierarchy.getTask()>0?m(".selector",[m(".selector-header",["Inspanningen"]),m(".selectorlist",m(".selectorlist-back",Models.Effort.getContent().map(function(o,r){return m(".state-selectable.selectorlist-item",{class:(e(o.id)?"state-selected":"")+" "+(n(o.id)?"state-editing":""),onclick:function(){viewModels.Hierarchy.updateEffort(o.id)}},[m(".selectorlist-item-number",[m(".button-number",r+1),m(".selectorlist-item-edit.button-edit-small",{class:t(o.id)?"state-editable":"",onclick:function(){viewModels.editMode.set("effort",o)}},"Bewerken")]),m(".selectorlist-item-content",[m(".effortselector-title",o.name),m(".effortselector-hidden",[m(".effortselector-description",o.description),m(".effortselector-subheader","type"),m(".effortselector-type",viewModels.typeNames[o.type]),m(".effortselector-subheader","mensen"),m(".effortselector-peoplelist",o.People.map(function(e){return m(".effortselector-peoplelist",e.name)}))])])])})))]):[]}}},NavBar=function(){return{view:function(e){return m("nav",[m(".nav-dashbutton",[m(".nav-dashbutton-icon")])])}}},ProgramBar=function(){function e(e){return viewModels.Hierarchy.getProgram()===e}function t(e){return e.replace(/ en /g," & ").replace(/[a-z ]/g,"")}return Models.Program.loadContent(),{view:function(n){var o=0;return m(".programbar",[Models.Program.getContent().map(function(n){return m(".programbar-domain",[n.Programs.map(function(n){return o++,m(".state-selectable.programbar-program",{class:e(n.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateProgram(n.id,n.name)}},[m(".programbar-program-number.button-number",t(n.name)),m(".programbar-program-title",n.name)])})])})])}}},TaskSelector=function(){function e(e){return viewModels.Hierarchy.getTask()===e}return{view:function(t){return viewModels.Hierarchy.getProgram()>0?m(".selector",[m(".selector-header",[viewModels.Hierarchy.getProgramName()]),m(".selectorlist",m(".selectorlist-back",Models.Task.getContent().map(function(t,n){return m(".state-selectable.selectorlist-item",{class:e(t.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateTask(t.id)}},[m(".selectorlist-item-number",[m(".button-number",n+1),m(".selectorlist-item-edit.button-edit-small","Bewerken")]),m(".selectorlist-item-content",[m(".taskselector-title",[m("span.taskselector-title-name",t.name),t.means?[m("span.taskselector-title-means-label"," door "),m("span.taskselector-title-means",t.means)]:[]])])])})))]):[]}}},TextArea=function(){var e=0;return{view:function(t){return m("textarea.textarea[placeholder="+t.attrs.placeholder+"][wrap=hard]",{oninput:m.withAttr("value",function(e){t.attrs.onchange(e)}),onchange:m.withAttr("value",function(e){t.attrs.onchange(e)}),value:t.attrs.value,oncreate:function(e){e.attrs.autofocus&&setTimeout(function(){e.dom.focus()},10)},onbeforeupdate:function(t,n){e=n.dom.selectionStart},onupdate:function(t){t.dom.selectionStart=e,t.dom.selectionEnd=e}})}}},Page=function(){return{view:function(e){return[m(".layout-nav-top",m(NavBar)),m(".layout-nav-left",m(ProgramBar)),m(".layout-workspace",[m(".layout-column",m(TaskSelector)),m(".layout-column",m(EffortSelector))]),m(".layout-editor",m(Editor))]}}};