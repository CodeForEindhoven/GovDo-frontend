var config={api_endpoint:"http://api.test.planlab.wolkenmachine.nl/"};Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t};var Models={},model={get:function(e,t,n){m.request({method:"GET",url:config.api_endpoint+e}).then(n)},post:function(e,t,n){m.request({method:"POST",url:config.api_endpoint+e,data:t}).then(n)},delete:function(e,t,n){m.request({method:"DELETE",url:config.api_endpoint+e,data:t}).then(n)}};Models.Program=function(){function e(){model.get("domain",{},function(e){i=e})}function t(t,n,o){model.post("program",{name:t,mission:n},function(t){e(),o(t.id)})}function n(t,n,o,i){model.post("program/"+t,{name:n,mission:o},function(t){e(),i(t.id)})}function o(){return i}var i=[];return{newItem:t,updateItem:n,loadContent:e,getContent:o}}(),Models.Task=function(){function e(){model.get("program/"+a,{},function(e){s=e.Tasks,d=e.name})}function t(){return s}function n(){return d}function o(t){t!==a&&(a=t,t>0&&e())}function i(t,n,o){model.post("task",{program:a,name:t,means:n},function(t){e(),o(t.id)})}function r(t,n,o,i){model.post("task/"+t,{name:n,means:o},function(t){e(),i(t.id)})}var a=-1,s=[],d="";return{newItem:i,updateItem:r,loadContent:e,getContent:t,getName:n,updateContent:o}}(),Models.Effort=function(){function e(){model.get("task/"+s,{},function(e){d=e.Efforts,c=e.name})}function t(){return d}function n(){return c}function o(t){t!==s&&(s=t,t>0&&e())}function i(t,n,o,i,r){model.post("effort",{task:s,name:t,description:n,type:o,people:i},function(t){e(),r(t.id)})}function r(t,n,o,i,r,a){model.post("effort/"+t,{name:n,description:o,type:i,people:r},function(t){e(),a(t.id)})}function a(t,n){model.delete("effort/"+t,{},function(t){e(),n(t)})}var s=-1,d=[],c="";return{newItem:i,updateItem:r,deleteItem:a,loadContent:e,getContent:t,getName:n,updateContent:o}}(),Models.Person=function(){function e(){model.get("people",{},function(e){r=e})}function t(){return r}function n(){model.get("teams",{},function(e){a=e})}function o(){return a}function i(t,n){model.post("person",{name:t},function(t){e(),n(t)})}var r=[],a=[];return{loadPeople:e,getPeople:t,loadTeams:n,getTeams:o,newItem:i}}(),Models.Changes=function(){function e(){model.get("changes",{},function(e){o=e.map(function(e){return e.new=!1,e.updatedAt==e.createdAt&&(e.new=!0),e.date=n(new Date(e.updatedAt)),e.task=e.Tasks[0].name,e.program=e.Tasks[0].Programs[0].name,e})})}function t(){return o}function n(e){var t=Math.floor((new Date-e)/1e3),n=Math.floor(t/31536e3);return n>1?n+" jaar":(n=Math.floor(t/2592e3))>1?n+" maanden":(n=Math.floor(t/604800))>1?n+" weken":(n=Math.floor(t/86400))>1?n+" dagen":(n=Math.floor(t/3600))>1?n+" uur":(n=Math.floor(t/60),n>1?n+" minuten":Math.floor(t)+" seconden")}var o=[];return{loadContent:e,getContent:t}}(),Models.Search=function(){function e(){model.get("search",{},function(e){n=e.map(function(e){return e.task=e.Tasks[0].name,e.program=e.Tasks[0].Programs[0].name,e})})}function t(){return n}var n=[];return{loadContent:e,getContent:t}}();var viewModels={};viewModels.Hierarchy=function(){function e(e,t){c=e,u=-1,m=-1,l=t,Models.Task.updateContent(c)}function t(){return c}function n(){return l}function o(e){u=e,m=-1,Models.Effort.updateContent(u)}function i(){return u}function r(e){m=e}function a(){return m}function s(e){console.log(e),f=e}function d(t,n,i){e(t),o(n),r(i)}var c=-1,l={},u=-1,m=-1,f=-1;return{updatePerson:s,updateProgram:e,updateTask:o,updateEffort:r,getProgram:t,getTask:i,getEffort:a,getProgramDetails:n,jumpTo:d}}(),viewModels.typeNames=["Project","Programma","Routine","Proces","Improvisatie","Klusje"],viewModels.editMode=function(){var e=!1,t="",n={};return{state:function(){return e},isType:function(e){return t===e},content:function(){return n},setContent:function(e,t){n[e]=t},set:function(o,i){e=!0,t=o,i&&(n=JSON.parse(JSON.stringify(i)))},new:function(o){e=!0,"effort"===(t=o)&&(n={id:-1,name:"",description:"",type:-1,People:[]}),"task"===t&&(n={id:-1,name:"",means:""})},close:function(){e=!1,t="",n={}},save:function(){console.log("save"),"effort"===t?(console.log("effort"),-1===n.id?(console.log("new"),Models.Effort.newItem(n.name,n.description,n.type,n.People,function(e){viewModels.Hierarchy.updateEffort(n.id),viewModels.editMode.close()})):(console.log("update"),Models.Effort.updateItem(n.id,n.name,n.description,n.type,n.People,function(e){viewModels.Hierarchy.updateEffort(n.id),viewModels.editMode.close()}))):"task"===t&&(console.log("task"),-1===n.id?(console.log("new"),Models.Task.newItem(n.name,n.means,function(e){viewModels.Hierarchy.updateTask(n.id),viewModels.editMode.close()})):(console.log("update"),Models.Task.updateItem(n.id,n.name,n.means,function(e){viewModels.Hierarchy.updateTask(n.id),viewModels.editMode.close()})))},delete:function(){console.log("delete"),!0===window.confirm("Weet u zeker dat u dit wilt verwijderen?")&&"effort"===t&&(console.log("effort"),-1===n.id?viewModels.editMode.close():Models.Effort.deleteItem(n.id,function(){viewModels.editMode.close()}))}}}();var API_VERSION="0.1.0";model.get("",{},function(e){e.version!==API_VERSION?(console.log("out of sync!"),location.reload(!0)):m.route(document.body,"/",{"/":Page})});var Editor=function(){return{view:function(e){return m(".editor",{class:viewModels.editMode.state()?"state-edit":"state-hidden"},[function(){return viewModels.editMode.isType("effort")?m(EffortEditor):viewModels.editMode.isType("task")?m(TaskEditor):void 0}(),m(".editor-buttons",[m(".button-edit",{onclick:function(){viewModels.editMode.save()}},"Opslaan"),m(".button",{onclick:function(){viewModels.editMode.close()}},"Annuleer"),m(".button-right",{onclick:function(){viewModels.editMode.delete()}},"Verwijder")])])}}},EffortEditor=function(){return{view:function(e){return m(".efforteditor",[m(".editor-subtitle","Inspanning titel"),m(TextArea,{value:viewModels.editMode.content().name,placeholder:"title",onchange:function(e){viewModels.editMode.setContent("name",e)}}),m(".editor-subtitle","Inspanning beschrijving"),m(TextArea,{value:viewModels.editMode.content().description,placeholder:"beschrijving",onchange:function(e){viewModels.editMode.setContent("description",e)}}),m(".editor-subtitle","Mensen"),m(PeopleListEditor,{value:viewModels.editMode.content().People,onchange:function(e){viewModels.editMode.setContent("People",e)}}),m(".editor-subtitle","Type"),m(TypeEditor,{type:viewModels.editMode.content().type,startdate:viewModels.editMode.content().startdate,enddate:viewModels.editMode.content().enddate,onchange:function(e){viewModels.editMode.setContent("type",e)},onchangeStartDate:function(e){viewModels.editMode.setContent("startdate",e)},onchangeEndDate:function(e){viewModels.editMode.setContent("enddate",e)}})])}}},PeopleListEditor=function(){return{view:function(e){return m(".editor-peoplelist",[e.attrs.value.map(function(t){return m(".editor-peoplelist-person",[m("span",t.name),m("span.editor-peoplelist-person-remove",{onclick:function(){for(var n=e.attrs.value,o=n.length-1;o>=0;o--)n[o].id===t.id&&n.splice(o,1);e.attrs.onchange(n)}},m("i",{class:"material-icons"},"close"))])})])}}},TypeEditor=function(){return{view:function(e){return m(".editor-typeselect",[viewModels.typeNames.map(function(t,n){return m(".editor-typeselect-type",{class:e.attrs.type===n?"state-selected":"",onclick:function(){e.attrs.onchange(n)}},[m(".editor-typeselect-type-name",t),m("i",{class:"material-icons hide-icon"},"info_outline"),m(".editor-typeselect-type-timespan",{class:e.attrs.type===n&&n<2?"state-visible":""},[m(".editor-typeselect-type-timespan-subtitle","van"),m(".editor-typeselect-type-timespan-timebox",m(DatePicker,{value:e.attrs.startdate,onchange:e.attrs.onchangeStartDate})),m(".editor-typeselect-type-timespan-subtitle","t/m"),m(".editor-typeselect-type-timespan-timebox",m(DatePicker,{value:e.attrs.enddate,onchange:e.attrs.onchangeEndDate}))])])})])}}},EffortSelector=function(){function e(e){return viewModels.Hierarchy.getEffort()===e}function t(t){return!viewModels.editMode.state()&&e(t)}function n(e){return!!viewModels.editMode.state()&&viewModels.editMode.content().id===e}return{view:function(o){return viewModels.Hierarchy.getTask()>0?m(".selector",[m(".selector-header",[m("span","Inspanningen"),m("i.material-icons",{},"info_outline"),m("i.material-icons",{},"import_export"),m("i.material-icons",{class:viewModels.editMode.state()?"state-hidden":"",onclick:function(){viewModels.editMode.new("effort")}},"add")]),m(".selectorlist",m(".selectorlist-back",Models.Effort.getContent().map(function(o,i){return m(".state-selectable.selectorlist-item",{class:(e(o.id)?"state-selected":"")+" "+(n(o.id)?"state-editing":""),onclick:function(){viewModels.Hierarchy.updateEffort(o.id)}},[m(".selectorlist-item-number",[m(".button-number",i+1),m(".selectorlist-item-edit.button-edit-small",{class:t(o.id)?"":"state-hidden",onclick:function(){viewModels.editMode.set("effort",o)}},m("i.material-icons","build"))]),m(".selectorlist-item-content",[m(".effortselector-title",o.name),m(".effortselector-hidden",[m(".effortselector-type",viewModels.typeNames[o.type]),m(".effortselector-description",o.description),m(".effortselector-subheader","Mensen"),m(".effortselector-peoplelist",o.People.map(function(e){return m(".effortselector-peoplelist",e.name)}))])])])})))]):[]}}},NavBar=function(){return{view:function(e){return m("nav",[m(".nav-dashbutton",[m(".nav-dashbutton-icon")])])}}},ProgramBar=function(){function e(e){return viewModels.Hierarchy.getProgram()===e}function t(e){return e.replace(/ en /g," & ").replace(/[a-z ]/g,"")}return Models.Program.loadContent(),{view:function(n){var o=0;return m(".programbar",[Models.Program.getContent().map(function(n){return m(".programbar-domain",[m(".programbar-domain-name",n.name),n.Programs.map(function(n){return o++,m(".state-selectable.programbar-program",{class:e(n.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateProgram(n.id,n)}},[m(".programbar-program-number.button-number",t(n.name)),m(".programbar-program-title",n.name)])})])})])}}},ProgramDetails=function(){var e=!1;return{view:function(t){if(viewModels.Hierarchy.getProgram()>0)return m(".programdetails",[m(".programdetails-title",viewModels.Hierarchy.getProgramDetails().name),m("i.material-icons",{onclick:function(){e=!e},class:e?"state-hidden":""},"arrow_drop_down"),m("i.material-icons",{onclick:function(){e=!e},class:e?"":"state-hidden"},"arrow_drop_up"),m(".programdetails-mission",{class:e?"":"state-hidden"},viewModels.Hierarchy.getProgramDetails().mission)])}}},TaskEditor=function(){return{view:function(e){return m(".efforteditor",[m(".editor-subtitle","Opgave titel"),m(TextArea,{value:viewModels.editMode.content().name,placeholder:"title",onchange:function(e){viewModels.editMode.setContent("name",e)}}),m(".editor-subtitle opg-door","door"),m(TextArea,{value:viewModels.editMode.content().means,placeholder:"door",onchange:function(e){viewModels.editMode.setContent("means",e)}})])}}},TaskSelector=function(){function e(e){return viewModels.Hierarchy.getTask()===e}function t(t){return!viewModels.editMode.state()&&e(t)}function n(e){return!!viewModels.editMode.state()&&viewModels.editMode.content().id===e}return{view:function(o){return viewModels.Hierarchy.getProgram()>0?m(".selector",[m(".selector-header",[m("span","Opgaven"),m("i.material-icons",{},"info_outline"),m("i.material-icons",{},"import_export"),m("i.material-icons",{class:viewModels.editMode.state()?"state-hidden":"",onclick:function(){viewModels.editMode.new("task")}},"add")]),m(".selectorlist",m(".selectorlist-back",Models.Task.getContent().map(function(o,i){return m(".state-selectable.selectorlist-item",{class:(e(o.id)?"state-selected":"")+" "+(n(o.id)?"state-editing":""),onclick:function(){viewModels.Hierarchy.updateTask(o.id)}},[m(".selectorlist-item-number",[m(".button-number",i+1),m(".selectorlist-item-edit.button-edit-small",{class:t(o.id)?"":"state-hidden",onclick:function(){viewModels.editMode.set("task",o)}},m("i.material-icons","build"))]),m(".selectorlist-item-content",[m(".taskselector-title",[m("span.taskselector-title-name",o.name),o.means?[m("span.taskselector-title-means-label"," door "),m("span.taskselector-title-means",o.means)]:[]])])])})))]):[]}}},DatePicker=function(){var e="00",t="00",n="0000";return{view:function(o){function i(){o.attrs.onchange({day:parseInt(e),month:parseInt(t),year:parseInt(n)})}return o.attrs.value&&(e=o.attrs.value.day.pad(),t=o.attrs.value.month.pad(),n=o.attrs.value.year.pad(4)),m(".datepicker",[m("input.input.datepicker-day[placeholder=00]",{value:e,onchange:function(t){e=t.target.value,i()}}),m(".datepicker-dash","-"),m("input.input.datepicker-month[placeholder=00]",{value:t,onchange:function(e){t=e.target.value,i()}}),m(".datepicker-dash","-"),m("input.input.datepicker-year[placeholder=0000]",{value:n,onchange:function(e){n=e.target.value,i()}})])}}},TextArea=function(){var e=0;return{view:function(t){return m("textarea.textarea[placeholder="+t.attrs.placeholder+"][wrap=hard]",{oninput:m.withAttr("value",function(e){t.attrs.onchange(e)}),onchange:m.withAttr("value",function(e){t.attrs.onchange(e)}),value:t.attrs.value,oncreate:function(e){e.attrs.autofocus&&setTimeout(function(){e.dom.focus()},10)},onbeforeupdate:function(t,n){e=n.dom.selectionStart},onupdate:function(t){t.dom.selectionStart=e,t.dom.selectionEnd=e}})}}},Page=function(){return{view:function(e){return[m(".layout-nav-top",m(NavBar)),m(".layout-nav-left",m(ProgramBar)),m(".layout-workspace",[m(".layout-column",[m(ProgramDetails),m(TaskSelector)]),m(".layout-column effort",m(EffortSelector))]),m(".layout-editor",m(Editor))]}}};