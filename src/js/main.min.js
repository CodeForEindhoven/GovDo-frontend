var config={api_endpoint:"http://api.planlab.wolkenmachine.nl/"},Models={},model={get:function(e,t,n){m.request({method:"GET",url:config.api_endpoint+e}).then(n)},post:function(e,t,n){m.request({method:"POST",url:config.api_endpoint+e,data:t}).then(n)}};Models.Program=function(){function e(){model.get("domain",{},function(e){r=e})}function t(t,n,o){model.post("program",{name:t,mission:n},function(t){e(),o(t.id)})}function n(t,n,o,r){model.post("program/"+t,{name:n,mission:o},function(t){e(),r(t.id)})}function o(){return r}var r=[];return{newItem:t,updateItem:n,loadContent:e,getContent:o}}(),Models.Task=function(){function e(){model.get("program/"+i,{},function(e){m=e.Tasks,u=e.name})}function t(){return m}function n(){return u}function o(t){t!==i&&(i=t,t>0&&e())}function r(t,n,o){model.post("task",{program:i,name:t,means:n},function(t){e(),o(t.id)})}function a(t,n,o,r){model.post("task/"+t,{name:n,means:o},function(t){e(),r(t.id)})}var i=-1,m=[],u="";return{newItem:r,updateItem:a,loadContent:e,getContent:t,getName:n,updateContent:o}}(),Models.Effort=function(){function e(){model.get("task/"+i,{},function(e){m=e.Efforts,u=e.name})}function t(){return m}function n(){return u}function o(t){t!==i&&(i=t,t>0&&e())}function r(t,n,o,r){model.post("effort",{task:i,name:t,type:n,people:o},function(t){e(),r(t.id)})}function a(t,n,o,r,a){model.post("effort/"+t,{name:n,type:o,people:r},function(t){e(),a(t.id)})}var i=-1,m=[],u="";return{newItem:r,updateItem:a,loadContent:e,getContent:t,getName:n,updateContent:o}}(),Models.Person=function(){function e(){model.get("people",{},function(e){a=e})}function t(){return a}function n(){model.get("teams",{},function(e){i=e})}function o(){return i}function r(t,n){model.post("person",{name:t},function(t){e(),n(t)})}var a=[],i=[];return{loadPeople:e,getPeople:t,loadTeams:n,getTeams:o,newItem:r}}(),Models.Changes=function(){function e(){model.get("changes",{},function(e){o=e.map(function(e){return e.new=!1,e.updatedAt==e.createdAt&&(e.new=!0),e.date=n(new Date(e.updatedAt)),e.task=e.Tasks[0].name,e.program=e.Tasks[0].Programs[0].name,e})})}function t(){return o}function n(e){var t=Math.floor((new Date-e)/1e3),n=Math.floor(t/31536e3);return n>1?n+" jaar":(n=Math.floor(t/2592e3))>1?n+" maanden":(n=Math.floor(t/604800))>1?n+" weken":(n=Math.floor(t/86400))>1?n+" dagen":(n=Math.floor(t/3600))>1?n+" uur":(n=Math.floor(t/60),n>1?n+" minuten":Math.floor(t)+" seconden")}var o=[];return{loadContent:e,getContent:t}}(),Models.Search=function(){function e(){model.get("search",{},function(e){n=e.map(function(e){return e.task=e.Tasks[0].name,e.program=e.Tasks[0].Programs[0].name,e})})}function t(){return n}var n=[];return{loadContent:e,getContent:t}}();var viewModels={};viewModels.Hierarchy=function(){function e(e,t){s=e,l=-1,f=-1,c=t,Models.Task.updateContent(s)}function t(){return s}function n(){return c}function o(e){l=e,f=-1,Models.Effort.updateContent(l)}function r(){return l}function a(e){f=e}function i(){return f}function m(e){console.log(e),d=e}function u(t,n,r){e(t),o(n),a(r)}var s=-1,c="",l=-1,f=-1,d=-1;return{updatePerson:m,updateProgram:e,updateTask:o,updateEffort:a,getProgram:t,getTask:r,getEffort:i,getProgramName:n,jumpTo:u}}(),viewModels.typeName=function(e){return["Project","Programma","Routine","Proces","Improvisatie","Klusje"][e]};var API_VERSION="0.1.0";model.get("",{},function(e){e.version!==API_VERSION?(console.log("out of sync!"),location.reload(!0)):m.route(document.body,"/",{"/":Page})});var EffortSelector=function(){function e(e){return viewModels.Hierarchy.getEffort()===e}return{view:function(t){return viewModels.Hierarchy.getTask()>0?m(".selector",[m(".selector-header",["Inspanningen"]),m(".selectorlist",m(".selectorlist-back",Models.Effort.getContent().map(function(t,n){return m(".state-selectable.selectorlist-item",{class:e(t.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateEffort(t.id)}},[m(".selectorlist-item-number",[m(".button-number",n+1),m(".selectorlist-item-edit.button-edit","Bewerken")]),m(".selectorlist-item-content",[m(".effortselector-title",t.name),m(".effortselector-hidden",[m(".effortselector-subheader","type"),m(".effortselector-type",viewModels.typeName(t.type)),m(".effortselector-subheader","mensen"),m(".effortselector-peoplelist",t.People.map(function(e){return m(".effortselector-peoplelist",e.name)}))])])])})))]):m(".message","no content")}}},NavBar=function(){return{view:function(e){return m("nav",[m(".nav-dashbutton",[m(".nav-dashbutton-icon")])])}}},ProgramBar=function(){function e(e){return viewModels.Hierarchy.getProgram()===e}function t(e){return e.replace(/ en /g," & ").replace(/[a-z ]/g,"")}return Models.Program.loadContent(),{view:function(n){var o=0;return m(".programbar",[Models.Program.getContent().map(function(n){return m(".programbar-domain",[n.Programs.map(function(n){return o++,m(".state-selectable.programbar-program",{class:e(n.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateProgram(n.id,n.name)}},[m(".programbar-program-number.button-number",t(n.name)),m(".programbar-program-title",n.name)])})])})])}}},TaskSelector=function(){function e(e){return viewModels.Hierarchy.getTask()===e}return{view:function(t){return viewModels.Hierarchy.getProgram()>0?m(".selector",[m(".selector-header",[viewModels.Hierarchy.getProgramName()]),m(".selectorlist",m(".selectorlist-back",Models.Task.getContent().map(function(t,n){return m(".state-selectable.selectorlist-item",{class:e(t.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateTask(t.id)}},[m(".selectorlist-item-number",[m(".button-number",n+1),m(".selectorlist-item-edit.button-edit","Bewerken")]),m(".selectorlist-item-content",[m(".taskselector-title",[m("span.taskselector-title-name",t.name),t.means?[m("span.taskselector-title-means-label"," door "),m("span.taskselector-title-means",t.means)]:[]])])])})))]):m(".message","no content")}}},Page=function(){return{view:function(e){return[m(".layout-nav-top",m(NavBar)),m(".layout-nav-left",m(ProgramBar)),m(".layout-workspace",[m(".layout-column",m(TaskSelector)),m(".layout-column",m(EffortSelector)),m(".layout-column","editor")])]}}};