var config={api_endpoint:"http://api.planlab.wolkenmachine.nl/"},Models={},model={get:function(n,t,e){m.request({method:"GET",url:config.api_endpoint+n}).then(e)},post:function(n,t,e){m.request({method:"POST",url:config.api_endpoint+n,data:t}).then(e)}};Models.Program=function(){function n(){model.get("domain",{},function(n){a=n})}function t(t,e,o){model.post("program",{name:t,mission:e},function(t){n(),o(t.id)})}function e(t,e,o,a){model.post("program/"+t,{name:e,mission:o},function(t){n(),a(t.id)})}function o(){return a}var a=[];return{newItem:t,updateItem:e,loadContent:n,getContent:o}}(),Models.Task=function(){function n(){model.get("program/"+u,{},function(n){m=n.Tasks,i=n.name})}function t(){return m}function e(){return i}function o(t){t!==u&&(u=t,t>0&&n())}function a(t,e,o){model.post("task",{program:u,name:t,means:e},function(t){n(),o(t.id)})}function r(t,e,o,a){model.post("task/"+t,{name:e,means:o},function(t){n(),a(t.id)})}var u=-1,m=[],i="";return{newItem:a,updateItem:r,loadContent:n,getContent:t,getName:e,updateContent:o}}(),Models.Effort=function(){function n(){model.get("task/"+u,{},function(n){m=n.Efforts,i=n.name})}function t(){return m}function e(){return i}function o(t){t!==u&&(u=t,t>0&&n())}function a(t,e,o,a){model.post("effort",{task:u,name:t,type:e,people:o},function(t){n(),a(t.id)})}function r(t,e,o,a,r){model.post("effort/"+t,{name:e,type:o,people:a},function(t){n(),r(t.id)})}var u=-1,m=[],i="";return{newItem:a,updateItem:r,loadContent:n,getContent:t,getName:e,updateContent:o}}(),Models.Person=function(){function n(){model.get("people",{},function(n){r=n})}function t(){return r}function e(){model.get("teams",{},function(n){u=n})}function o(){return u}function a(t,e){model.post("person",{name:t},function(t){n(),e(t)})}var r=[],u=[];return{loadPeople:n,getPeople:t,loadTeams:e,getTeams:o,newItem:a}}(),Models.Changes=function(){function n(){model.get("changes",{},function(n){o=n.map(function(n){return n.new=!1,n.updatedAt==n.createdAt&&(n.new=!0),n.date=e(new Date(n.updatedAt)),n.task=n.Tasks[0].name,n.program=n.Tasks[0].Programs[0].name,n})})}function t(){return o}function e(n){var t=Math.floor((new Date-n)/1e3),e=Math.floor(t/31536e3);return e>1?e+" jaar":(e=Math.floor(t/2592e3))>1?e+" maanden":(e=Math.floor(t/604800))>1?e+" weken":(e=Math.floor(t/86400))>1?e+" dagen":(e=Math.floor(t/3600))>1?e+" uur":(e=Math.floor(t/60),e>1?e+" minuten":Math.floor(t)+" seconden")}var o=[];return{loadContent:n,getContent:t}}(),Models.Search=function(){function n(){model.get("search",{},function(n){e=n.map(function(n){return n.task=n.Tasks[0].name,n.program=n.Tasks[0].Programs[0].name,n})})}function t(){return e}var e=[];return{loadContent:n,getContent:t}}();var viewModels={};viewModels.Hierarchy=function(){function n(n,t){s=n,f=-1,l=-1,c=t,Models.Task.updateContent(s)}function t(){return s}function e(){return c}function o(n){f=n,l=-1,Models.Effort.updateContent(f)}function a(){return f}function r(n){l=n}function u(){return l}function m(n){console.log(n),d=n}function i(t,e,a){n(t),o(e),r(a)}var s=-1,c="",f=-1,l=-1,d=-1;return{updatePerson:m,updateProgram:n,updateTask:o,updateEffort:r,getProgram:t,getTask:a,getEffort:u,getProgramName:e,jumpTo:i}}();var API_VERSION="0.1.0";model.get("",{},function(n){n.version!==API_VERSION?(console.log("out of sync!"),location.reload(!0)):m.route(document.body,"/",{"/":Page})});var NavBar=function(){return{view:function(n){return m("nav",[m(".nav-dashbutton",[m(".nav-dashbutton-icon")])])}}},ProgramBar=function(){function n(n){return viewModels.Hierarchy.getProgram()===n}function t(n){return n.replace(/ en /g," & ").replace(/[a-z ]/g,"")}return Models.Program.loadContent(),{view:function(e){var o=0;return m(".programbar",[Models.Program.getContent().map(function(e){return m(".programbar-domain",[e.Programs.map(function(e){return o++,m(".programbar-program",{class:n(e.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateProgram(e.id,e.name)}},[m(".programbar-program-number.button-number",t(e.name)),m(".programbar-program-title",e.name),m(".programbar-program-mission",e.mission)])})])})])}}},TaskSelector=function(){return{view:function(n){return viewModels.Hierarchy.getProgram()>0?m(".taskselector",[m(".program-title",[viewModels.Hierarchy.getProgramName()]),m(".tasklist",Models.Task.getContent().map(function(n,t){return m(".tasklist-task",[m(".tasklist-task-number.button-number",t+1),m(".tasklist-task-title",[m("span.tasklist-task-title-name",n.name),n.means?[m("span.tasklist-task-title-means-label"," door "),m("span.tasklist-task-title-means",n.means)]:[]])])}))]):m(".message","no content")}}},Page=function(){return{view:function(n){return[m(".layout-nav-top",m(NavBar)),m(".layout-nav-left",m(ProgramBar)),m(".layout-workspace",[m(".layout-column",m(TaskSelector)),m(".layout-column",m(TaskSelector))])]}}};