var config={api_endpoint:"http://api.planlab.wolkenmachine.nl/"},Models={},model={get:function(t,n,e){m.request({method:"GET",url:config.api_endpoint+t}).then(e)},post:function(t,n,e){m.request({method:"POST",url:config.api_endpoint+t,data:n}).then(e)}};Models.Program=function(){function t(){model.get("domain",{},function(t){a=t})}function n(n,e,o){model.post("program",{name:n,mission:e},function(n){t(),o(n.id)})}function e(n,e,o,a){model.post("program/"+n,{name:e,mission:o},function(n){t(),a(n.id)})}function o(){return a}var a=[];return{newItem:n,updateItem:e,loadContent:t,getContent:o}}(),Models.Task=function(){function t(){model.get("program/"+u,{},function(t){i=t.Tasks,m=t.name})}function n(){return i}function e(){return m}function o(n){n!==u&&(u=n,n>0&&t())}function a(n,e,o){model.post("task",{program:u,name:n,means:e},function(n){t(),o(n.id)})}function r(n,e,o,a){model.post("task/"+n,{name:e,means:o},function(n){t(),a(n.id)})}var u=-1,i=[],m="";return{newItem:a,updateItem:r,loadContent:t,getContent:n,getName:e,updateContent:o}}(),Models.Effort=function(){function t(){model.get("task/"+u,{},function(t){i=t.Efforts,m=t.name})}function n(){return i}function e(){return m}function o(n){n!==u&&(u=n,n>0&&t())}function a(n,e,o,a){model.post("effort",{task:u,name:n,type:e,people:o},function(n){t(),a(n.id)})}function r(n,e,o,a,r){model.post("effort/"+n,{name:e,type:o,people:a},function(n){t(),r(n.id)})}var u=-1,i=[],m="";return{newItem:a,updateItem:r,loadContent:t,getContent:n,getName:e,updateContent:o}}(),Models.Person=function(){function t(){model.get("people",{},function(t){r=t})}function n(){return r}function e(){model.get("teams",{},function(t){u=t})}function o(){return u}function a(n,e){model.post("person",{name:n},function(n){t(),e(n)})}var r=[],u=[];return{loadPeople:t,getPeople:n,loadTeams:e,getTeams:o,newItem:a}}(),Models.Changes=function(){function t(){model.get("changes",{},function(t){o=t.map(function(t){return t.new=!1,t.updatedAt==t.createdAt&&(t.new=!0),t.date=e(new Date(t.updatedAt)),t.task=t.Tasks[0].name,t.program=t.Tasks[0].Programs[0].name,t})})}function n(){return o}function e(t){var n=Math.floor((new Date-t)/1e3),e=Math.floor(n/31536e3);return e>1?e+" jaar":(e=Math.floor(n/2592e3))>1?e+" maanden":(e=Math.floor(n/604800))>1?e+" weken":(e=Math.floor(n/86400))>1?e+" dagen":(e=Math.floor(n/3600))>1?e+" uur":(e=Math.floor(n/60),e>1?e+" minuten":Math.floor(n)+" seconden")}var o=[];return{loadContent:t,getContent:n}}(),Models.Search=function(){function t(){model.get("search",{},function(t){e=t.map(function(t){return t.task=t.Tasks[0].name,t.program=t.Tasks[0].Programs[0].name,t})})}function n(){return e}var e=[];return{loadContent:t,getContent:n}}();var viewModels={};viewModels.Hierarchy=function(){function t(t,n){s=t,f=-1,l=-1,c=n,Models.Task.updateContent(s)}function n(){return s}function e(){return c}function o(t){f=t,l=-1,Models.Effort.updateContent(f)}function a(){return f}function r(t){l=t}function u(){return l}function i(t){console.log(t),d=t}function m(n,e,a){t(n),o(e),r(a)}var s=-1,c="",f=-1,l=-1,d=-1;return{updatePerson:i,updateProgram:t,updateTask:o,updateEffort:r,getProgram:n,getTask:a,getEffort:u,getProgramName:e,jumpTo:m}}();var API_VERSION="0.1.0";model.get("",{},function(t){t.version!==API_VERSION?(console.log("out of sync!"),location.reload(!0)):m.route(document.body,"/",{"/":Page})});var EffortSelector=function(){return{view:function(t){return viewModels.Hierarchy.getTask()>0?m(".taskselector",[m(".program-title",["Inspanningen"]),m(".tasklist",Models.Effort.getContent().map(function(t,n){return m(".tasklist-task",{onclick:function(){viewModels.Hierarchy.updateEffort(t.id)}},[m(".tasklist-task-number.button-number",n+1),m(".tasklist-task-title",[m("span.tasklist-task-title-name",t.name)])])}))]):m(".message","no content")}}},NavBar=function(){return{view:function(t){return m("nav",[m(".nav-dashbutton",[m(".nav-dashbutton-icon")])])}}},ProgramBar=function(){function t(t){return viewModels.Hierarchy.getProgram()===t}function n(t){return t.replace(/ en /g," & ").replace(/[a-z ]/g,"")}return Models.Program.loadContent(),{view:function(e){var o=0;return m(".programbar",[Models.Program.getContent().map(function(e){return m(".programbar-domain",[e.Programs.map(function(e){return o++,m(".programbar-program",{class:t(e.id)?"state-selected":"",onclick:function(){viewModels.Hierarchy.updateProgram(e.id,e.name)}},[m(".programbar-program-number.button-number",n(e.name)),m(".programbar-program-title",e.name),m(".programbar-program-mission",e.mission)])})])})])}}},TaskSelector=function(){return{view:function(t){return viewModels.Hierarchy.getProgram()>0?m(".taskselector",[m(".program-title",[viewModels.Hierarchy.getProgramName()]),m(".tasklist",Models.Task.getContent().map(function(t,n){return m(".tasklist-task",{onclick:function(){viewModels.Hierarchy.updateTask(t.id)}},[m(".tasklist-task-number.button-number",n+1),m(".tasklist-task-title",[m("span.tasklist-task-title-name",t.name),t.means?[m("span.tasklist-task-title-means-label"," door "),m("span.tasklist-task-title-means",t.means)]:[]])])}))]):m(".message","no content")}}},Page=function(){return{view:function(t){return[m(".layout-nav-top",m(NavBar)),m(".layout-nav-left",m(ProgramBar)),m(".layout-workspace",[m(".layout-column",m(TaskSelector)),m(".layout-column",m(EffortSelector))])]}}};